% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/RcppExports.R
\name{OBCorr}
\alias{OBCorr}
\title{Classical, robust, and independence correlations}
\usage{
OBCorr(df, method = "all", threads = 0L)
}
\arguments{
\item{df}{\code{data.frame} with \emph{at least two} numeric/logical variables. NAs are handled pairwise.}

\item{method}{String with one of the values:
\itemize{
\item \code{"pearson"}, \code{"spearman"}, \code{"kendall"};
\item \code{"hoeffding"}, \code{"distance"};
\item \code{"biweight"}, \code{"pbend"}, \code{"robust"} (\emph{= biweight + pbend});
\item \code{"alternative"} (\emph{= hoeffding + distance});
\item \code{"all"} (default).
}}

\item{threads}{Integer for OpenMP control (\code{0}=\emph{auto} according to \code{hardware_concurrency()}).}
}
\value{
\code{data.frame} in \emph{long} format, with columns:
\itemize{
\item \code{x}, \code{y}: variable names in the pair;
\item Statistics according to \code{method}: \code{pearson}, \code{spearman}, \code{kendall}, \code{hoeffding}, \code{distance}, \code{biweight}, \code{pbend}.
}
}
\description{
Function to compute, pairwise, \strong{classical}, \strong{robust}, and \strong{distribution-free} correlations between all numeric variables of a \code{data.frame}. Implements \strong{literature-based} versions of:
\itemize{
\item \strong{Pearson} (linear, parametric);
\item \strong{Spearman} (ranks with \emph{midranks});
\item \strong{Kendall tau-b} (corrects for ties);
\item \strong{Hoeffding's D} (U-statistic for independence, 30x scale as in \pkg{Hmisc});
\item \strong{Distance Correlation (dCor)} by Székely–Rizzo–Bakirov (2007);
\item \strong{Biweight midcorrelation} (\emph{bicor}, \pkg{WGCNA} style, with scaled MAD and \eqn{c=9});
\item \strong{Percentage Bend correlation} (\emph{pbcor}, Wilcox, with default \eqn{\beta=0.2}).
}

The implementation prioritizes \emph{pairwise complete observations}, numerical robustness, and performance (OpenMP), while preserving
formal definitions accepted in the literature and reference packages (e.g., \pkg{Hmisc}, \pkg{energy}, \pkg{WGCNA}, \pkg{WRS2}).
}
\details{
\strong{1) Classical correlations}

\emph{Pearson}. For valid pairs \eqn{(x_i,y_i)}, the correlation is
\deqn{r = \frac{\sum_i (x_i-\bar{x})(y_i-\bar{y})}{\sqrt{\sum_i (x_i-\bar{x})^2}\sqrt{\sum_i (y_i-\bar{y})^2}}.}
Ranges in \eqn{[-1,1]} and captures linear dependence.

\emph{Spearman}. Computes Pearson between \emph{midranks} \eqn{R_i,S_i}. Preserves \eqn{[-1,1]} and detects non-linear monotonicity.

\emph{Kendall tau-b}. Based on concordant/discordant pairs, corrects for ties in margins:
\deqn{\tau_b = \frac{C - D}{\sqrt{(C + D + T_x)(C + D + T_y)}},}
with \eqn{T_x,T_y} accounting for ties (including joint ties).

\strong{2) Hoeffding's D (implementation following SAS/\pkg{Hmisc})}

Measures \eqn{\int (F_{XY}-F_XF_Y)^2\,dF_{XY}} and is consistent against arbitrary dependence (includes non-monotonic).
Uses univariate \emph{midranks} \eqn{R,S} and bivariate rank \eqn{Q} (counts \eqn{\leq} with weights for ties).
The form used in \pkg{Hmisc} and SAS (\emph{30× scale}) is:
\deqn{D = 30 \cdot \frac{(n-2)(n-3)\sum (Q-1)(Q-2) + \sum (R-1)(R-2)(S-1)(S-2) - 2(n-2)\sum (R-2)(S-2)(Q-1)}{n(n-1)(n-2)(n-3)(n-4)},}
requiring \eqn{n\geq 5}. Under continuous margins, \eqn{D\in[-0.5,1]} (typically \eqn{[0,1]} without ties).

\strong{3) Distance correlation (dCor, 2007)}

With distance matrices \eqn{A_{ij}=|x_i-x_j|}, \eqn{B_{ij}=|y_i-y_j|}, performs \emph{double centering}:
\deqn{A^\circ_{ij} = A_{ij}-\bar{A}_{i\cdot}-\bar{A}_{\cdot j}+\bar{A}_{\cdot\cdot},\quad B^\circ_{ij} = B_{ij}-\bar{B}_{i\cdot}-\bar{B}_{\cdot j}+\bar{B}_{\cdot\cdot}.}
Defines
\deqn{\mathrm{dCov}^2 = \frac{1}{n^2}\sum_{i,j} A^\circ_{ij}B^\circ_{ij},\quad \mathrm{dVar}_X = \frac{1}{n^2}\sum_{i,j}(A^\circ_{ij})^2,\quad \mathrm{dVar}_Y = \frac{1}{n^2}\sum_{i,j}(B^\circ_{ij})^2,}
and the \emph{distance correlation}
\deqn{\mathrm{dCor} = \sqrt{\frac{\mathrm{dCov}^2}{\mathrm{dVar}_X\mathrm{dVar}_Y}}\in[0,1],}
being 0 iff independence (under conditions).

\strong{4) Biweight midcorrelation (bicor)}

With median \eqn{\tilde{x}} and scaled MAD \eqn{\widehat{\mathrm{MAD}}_x=1.4826\cdot\mathrm{MAD}}, defines
\eqn{u_i=(x_i-\tilde{x})/(c\widehat{\mathrm{MAD}}_x)}, \eqn{c=9}. Weights \eqn{w_i=(1-u_i^2)^2} if \eqn{|u_i|<1} and 0 otherwise.
Computes
\deqn{\mathrm{bicor}(x,y)=\frac{\sum_i w_i^{(x)}w_i^{(y)}(x_i-\tilde{x})(y_i-\tilde{y})}{\sqrt{\sum_i (w_i^{(x)})^2(x_i-\tilde{x})^2}\sqrt{\sum_i (w_i^{(y)})^2(y_i-\tilde{y})^2}}.}
Fallbacks: (i) variables with \eqn{\leq 2} unique values \eqn{\Rightarrow} Pearson; (ii) \eqn{\widehat{\mathrm{MAD}}\approx 0} \eqn{\Rightarrow} Pearson.

\strong{5) Percentage Bend correlation (pbcor, Wilcox)}

Using \eqn{\beta\in[0,0.5]}, computes \eqn{\widehat{W}} as the \eqn{(1-\beta)} quantile of absolute deviations from median; estimates \eqn{\widehat{\phi}} by
\emph{adaptive trimming}. Defines \eqn{U=(x-\widehat{\phi})/\widehat{W}}, applies \emph{clipping} \eqn{\Psi(u)=\min(\max(u,-1),1)}, and normalizes:
\deqn{\mathrm{pbcor}(x,y)=\frac{\sum_i \Psi(U_i^{(x)})\Psi(U_i^{(y)})}{\sqrt{\sum_i \Psi(U_i^{(x)})^2}\sqrt{\sum_i \Psi(U_i^{(y)})^2}}\in[-1,1].}

\strong{Input, output, and policies}
\itemize{
\item Only numeric/logical columns are considered (logical \eqn{\to} \{0,1\}). Observations are combined \emph{pairwise} (pairwise complete).
\item For each pair \eqn{(x,y)}, returns a \code{data.frame} with columns \code{x}, \code{y} and the statistics requested by the \code{method} argument.
\item Minimum sizes: \code{MIN_PAIRS_COR}=3 (Pearson/Spearman/Kendall/bicor/pbend); Hoeffding requires \eqn{n\geq 5}.
}

\strong{Complexity and performance}
\itemize{
\item Pearson/Spearman/Kendall: \eqn{O(n)} per pair (Kendall \eqn{O(n^2)} in naive form; suitable for moderate \emph{n}).
\item Hoeffding (this version): \eqn{O(n^2)} per pair (computation of bivariate \eqn{Q} with weights). For large \emph{n}, \eqn{O(n\log n)} versions are possible.
\item dCor: \eqn{O(n^2)} time and \eqn{O(n)} memory (without materialized \eqn{n\times n} matrices).
\item OpenMP: parallelizes over the space of variable pairs (\emph{outer loop}).
}
}
\note{
\itemize{
\item Values reported by \code{hoeffding} in this function follow the conventional \emph{30× scale} (\pkg{Hmisc}/SAS), facilitating comparisons.
\item \code{distance} returns the \emph{distance correlation} (not the squared version); 0 indicates independence (under conditions), 1 indicates perfect dependence.
\item Results may differ from implementations that use "unbiased" variants (dCor) or alternative schemes for \emph{ranking}/ties.
}
}
\section{Best practices for usage and interpretation}{

\itemize{
\item \strong{Pearson}: use when the relationship is plausibly linear and residuals ~ normal/homoscedastic. Outliers have large impact.
\item \strong{Spearman/Kendall}: preferable for non-linear monotonicity and/or ordinal data. Kendall tends to be more interpretable as probability of concordance.
\item \strong{Hoeffding's D}: ideal for \emph{non-monotonic} dependencies (e.g., U-shaped relationships). 30× scale (\pkg{Hmisc}) facilitates comparison with usual reports.
\item \strong{dCor}: measures strength of \emph{any} association (0 indicates independence under conditions). Useful as multivariate \emph{screening}.
\item \strong{bicor}: robust to outliers; if variables are binary/discrete with \eqn{\leq 2} values, falling back to Pearson avoids artifacts.
\item \strong{pbcor}: controls extreme influence via \eqn{\beta} (default \eqn{\beta=0.2}). Smaller \eqn{\beta} \eqn{\Rightarrow} less \emph{bending}; larger \eqn{\beta} \eqn{\Rightarrow} greater robustness and potential efficiency loss under normality.
\item \strong{Inference}: p-values and CIs are not returned; use specialized packages (e.g., \pkg{Hmisc} for Hoeffding, \pkg{energy} for dCor, \pkg{WRS2} for robust methods).
}
}

\section{Handling of extreme cases}{

\itemize{
\item If the number of valid pairs \eqn{< 3}, returns \code{NA_real_}.
\item In \code{bicor}: if \eqn{\widehat{\mathrm{MAD}}\approx 0} (or few effective points after weighting), returns Pearson.
\item In \code{pbend}: if \eqn{\widehat{W}\approx 0} or adaptive trimming empties the core, returns \code{NA_real_}.
\item In \code{hoeffding}: requires \eqn{n\geq 5}; otherwise \code{NA_real_}.
}
}

\section{Examples}{

\preformatted{
## Synthetic data
set.seed(123)
n  <- 120
x  <- rnorm(n)
yL <- 0.7*x + rnorm(n, sd=0.6)        # moderate linear relationship
yU <- (x^2) + rnorm(n, sd=0.4)        # U-shaped relationship (non-monotonic)
yO <- x; yO[sample(n, 5)] <- yO[sample(n, 5)] + 10  # outliers
df <- data.frame(x=x, yL=yL, yU=yU, yO=yO)

## 1) Complete panel
res_all <- OBCorr(df, method="all")
head(res_all)

## 2) Alternative methods (independence/non-linearity)
OBCorr(df, method="alternative")      # hoeffding + dCor

## 3) Robustness (outliers)
OBCorr(df, method="robust")           # bicor + pbend

## 4) Practical interpretation:
# - For (x, yL): High Pearson/Spearman/Kendall; high dCor; moderate/high Hoeffding.
# - For (x, yU): Pearson ~ 0; low Spearman; high dCor; high Hoeffding.
# - For (x, yO): Pearson degraded by outliers; bicor/pbend remain more stable.

## 5) Scaling with many variables
# Thread control (0 = auto)
OBCorr(df, method="distance", threads=0)
}
}

\references{
\itemize{
\item Hoeffding, W. (1948). \emph{A non-parametric test of independence}. Annals of Mathematical Statistics, 19(4), 546–557.
\item Székely, G. J., Rizzo, M. L., & Bakirov, N. K. (2007). \emph{Measuring and testing dependence by correlation of distances}. Annals of Statistics, 35(6), 2769–2794.
\item Székely, G. J., & Rizzo, M. L. (2013). \emph{The distance correlation t-test of independence in high dimension}. Journal of Multivariate Analysis, 117, 193–213.
\item Langfelder, P., & Horvath, S. (2008). \emph{WGCNA: an R package for weighted correlation network analysis}. BMC Bioinformatics, 9, 559.
\item Langfelder, P., & Horvath, S. (2012). \emph{Fast R Functions for Robust Correlations}. (Notes from \pkg{WGCNA} package and \emph{bicor} vignette.)
\item Wilcox, R. R. (2012/2017). \emph{Introduction to Robust Estimation and Hypothesis Testing}. Academic Press.
\item Rizzo, M. L., & Székely, G. J. (2022). \emph{energy: E-statistics (energy statistics)}. CRAN package.
\item Harrell, F. E. Jr. (2024). \emph{Hmisc: Harrell Miscellaneous}. CRAN package.
\item Mair, P., & Wilcox, R. R. (2020). \emph{WRS2: A Collection of Robust Statistical Methods}. CRAN package.
}
}
\seealso{
\itemize{
\item \pkg{Hmisc}::\code{hoeffd} (Hoeffding's D, 30× scale).
\item \pkg{energy}::\code{dcor} (Distance correlation).
\item \pkg{WGCNA}::\code{bicor} (Biweight midcorrelation).
\item \pkg{WRS2}::\code{pbcor} (Percentage bend correlation).
}
}
\keyword{OpenMP}
\keyword{Pearson}
\keyword{bicor}
\keyword{correlation}
\keyword{distance-correlation}
\keyword{hoeffding}
\keyword{independence}
\keyword{kendall}
\keyword{nonparametric}
\keyword{pbcor}
\keyword{robust}
\keyword{spearman}
