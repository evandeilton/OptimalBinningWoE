<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Optimal Binning for Categorical Variables using Simulated Annealing — optimal_binning_categorical_sab • OptimalBinningWoE</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimal Binning for Categorical Variables using Simulated Annealing — optimal_binning_categorical_sab"><meta name="description" content="Performs optimal binning for categorical variables using an enhanced Simulated Annealing
approach. This implementation maximizes Information Value (IV) while maintaining monotonicity
in the bins, using Bayesian smoothing for robust estimation and adaptive temperature scheduling
for better convergence."><meta property="og:description" content="Performs optimal binning for categorical variables using an enhanced Simulated Annealing
approach. This implementation maximizes Information Value (IV) while maintaining monotonicity
in the bins, using Bayesian smoothing for robust estimation and adaptive temperature scheduling
for better convergence."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OptimalBinningWoE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Optimal Binning for Categorical Variables using Simulated Annealing</h1>

      <div class="d-none name"><code>optimal_binning_categorical_sab.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs optimal binning for categorical variables using an enhanced Simulated Annealing
approach. This implementation maximizes Information Value (IV) while maintaining monotonicity
in the bins, using Bayesian smoothing for robust estimation and adaptive temperature scheduling
for better convergence.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">optimal_binning_categorical_sab</span><span class="op">(</span></span>
<span>  <span class="va">target</span>,</span>
<span>  <span class="va">feature</span>,</span>
<span>  min_bins <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  max_bins <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>  bin_cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  max_n_prebins <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>  bin_separator <span class="op">=</span> <span class="st">"%;%"</span>,</span>
<span>  initial_temperature <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cooling_rate <span class="op">=</span> <span class="fl">0.995</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>  convergence_threshold <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  adaptive_cooling <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p>An integer vector of binary target values (0 or 1).</p></dd>


<dt id="arg-feature">feature<a class="anchor" aria-label="anchor" href="#arg-feature"></a></dt>
<dd><p>A character vector of categorical feature values.</p></dd>


<dt id="arg-min-bins">min_bins<a class="anchor" aria-label="anchor" href="#arg-min-bins"></a></dt>
<dd><p>Minimum number of bins (default: 3).</p></dd>


<dt id="arg-max-bins">max_bins<a class="anchor" aria-label="anchor" href="#arg-max-bins"></a></dt>
<dd><p>Maximum number of bins (default: 5).</p></dd>


<dt id="arg-bin-cutoff">bin_cutoff<a class="anchor" aria-label="anchor" href="#arg-bin-cutoff"></a></dt>
<dd><p>Minimum proportion of observations in a bin (default: 0.05).</p></dd>


<dt id="arg-max-n-prebins">max_n_prebins<a class="anchor" aria-label="anchor" href="#arg-max-n-prebins"></a></dt>
<dd><p>Maximum number of pre-bins (default: 20).</p></dd>


<dt id="arg-bin-separator">bin_separator<a class="anchor" aria-label="anchor" href="#arg-bin-separator"></a></dt>
<dd><p>Separator string for merging categories (default: "%;%").</p></dd>


<dt id="arg-initial-temperature">initial_temperature<a class="anchor" aria-label="anchor" href="#arg-initial-temperature"></a></dt>
<dd><p>Initial temperature for Simulated Annealing (default: 1.0).</p></dd>


<dt id="arg-cooling-rate">cooling_rate<a class="anchor" aria-label="anchor" href="#arg-cooling-rate"></a></dt>
<dd><p>Cooling rate for Simulated Annealing (default: 0.995).</p></dd>


<dt id="arg-max-iterations">max_iterations<a class="anchor" aria-label="anchor" href="#arg-max-iterations"></a></dt>
<dd><p>Maximum number of iterations for Simulated Annealing (default: 1000).</p></dd>


<dt id="arg-convergence-threshold">convergence_threshold<a class="anchor" aria-label="anchor" href="#arg-convergence-threshold"></a></dt>
<dd><p>Threshold for convergence (default: 1e-6).</p></dd>


<dt id="arg-adaptive-cooling">adaptive_cooling<a class="anchor" aria-label="anchor" href="#arg-adaptive-cooling"></a></dt>
<dd><p>Whether to use adaptive cooling schedule (default: TRUE).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing the following elements:</p><ul><li><p>id: Numeric vector of bin identifiers.</p></li>
<li><p>bin: Character vector of bin names.</p></li>
<li><p>woe: Numeric vector of Weight of Evidence (WoE) values for each bin.</p></li>
<li><p>iv: Numeric vector of Information Value (IV) for each bin.</p></li>
<li><p>count: Integer vector of total counts for each bin.</p></li>
<li><p>count_pos: Integer vector of positive counts for each bin.</p></li>
<li><p>count_neg: Integer vector of negative counts for each bin.</p></li>
<li><p>total_iv: Total Information Value of the binning.</p></li>
<li><p>converged: Logical value indicating whether the algorithm converged.</p></li>
<li><p>iterations: Integer value indicating the number of iterations run.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This enhanced version of the Simulated Annealing Binning (SAB) algorithm implements several
key improvements over traditional approaches:</p>
<p><strong>Mathematical Framework:</strong></p>
<p>The Weight of Evidence (WoE) with Bayesian smoothing is calculated as:</p>
<p>$$WoE_i = \ln\left(\frac{p_i^*}{q_i^*}\right)$$</p>
<p>where:</p><ul><li><p>\(p_i^* = \frac{n_i^+ + \alpha \cdot \pi}{N^+ + \alpha}\) is the smoothed proportion of
events in bin i</p></li>
<li><p>\(q_i^* = \frac{n_i^- + \alpha \cdot (1-\pi)}{N^- + \alpha}\) is the smoothed proportion of
non-events in bin i</p></li>
<li><p>\(\pi = \frac{N^+}{N^+ + N^-}\) is the overall event rate</p></li>
<li><p>\(\alpha\) is the prior strength parameter (default: 0.5)</p></li>
<li><p>\(n_i^+\) is the count of events in bin i</p></li>
<li><p>\(n_i^-\) is the count of non-events in bin i</p></li>
<li><p>\(N^+\) is the total number of events</p></li>
<li><p>\(N^-\) is the total number of non-events</p></li>
</ul><p>The Information Value (IV) for each bin is calculated as:</p>
<p>$$IV_i = (p_i^* - q_i^*) \times WoE_i$$</p>
<p><strong>Simulated Annealing:</strong></p>
<p>The algorithm uses an enhanced version of Simulated Annealing with these key features:</p><ul><li><p>Multiple neighborhood generation strategies for better exploration</p></li>
<li><p>Adaptive temperature scheduling to escape local optima</p></li>
<li><p>Periodic restarting from the best known solution</p></li>
<li><p>Smart initialization using event rates for better starting points</p></li>
</ul><p>The probability of accepting a worse solution is calculated as:</p>
<p>$$P(accept) = \exp\left(\frac{\Delta IV}{T}\right)$$</p>
<p>where \(\Delta IV\) is the change in Information Value and \(T\) is the current temperature.</p>
<p><strong>Algorithm Phases:</strong></p><ol><li><p><strong>Initialization:</strong> Create initial bin assignments using a kmeans-like strategy based on event rates</p></li>
<li><p><strong>Optimization:</strong> Apply Simulated Annealing to find the optimal assignment of categories to bins</p></li>
<li><p><strong>Monotonicity Enforcement:</strong> Ensure the final solution has monotonic bin event rates</p></li>
</ol><p><strong>Key Features:</strong></p><ul><li><p>Bayesian smoothing for robust estimation with small samples</p></li>
<li><p>Multiple neighbor generation strategies for better search space exploration</p></li>
<li><p>Adaptive temperature scheduling to escape local optima</p></li>
<li><p>Smart initialization for better starting points</p></li>
<li><p>Strong monotonicity enforcement</p></li>
<li><p>Comprehensive handling of edge cases</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Kirkpatrick, S., Gelatt, C. D., &amp; Vecchi, M. P. (1983). Optimization by simulated annealing. science, 220(4598), 671-680.</p></li>
<li><p>Belotti, T., Crook, J. (2009). Credit Scoring with Macroeconomic Variables Using Survival Analysis. Journal of the Operational Research Society, 60(12), 1699-1707.</p></li>
<li><p>Mironchyk, P., &amp; Tchistiakov, V. (2017). Monotone optimal binning algorithm for credit risk modeling. arXiv preprint arXiv:1711.05095.</p></li>
<li><p>Gelman, A., Jakulin, A., Pittau, M. G., &amp; Su, Y. S. (2008). A weakly informative default prior distribution for logistic and other regression models. The annals of applied statistics, 2(4), 1360-1383.</p></li>
<li><p>Navas-Palencia, G. (2020). Optimal binning: mathematical programming formulations for binary classification. arXiv preprint arXiv:2001.08025.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Basic usage</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">1000</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="fl">1000</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">optimal_binning_categorical_sab</span><span class="op">(</span><span class="va">target</span>, <span class="va">feature</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Adjust simulated annealing parameters</span></span></span>
<span class="r-in"><span><span class="va">result2</span> <span class="op">&lt;-</span> <span class="fu">optimal_binning_categorical_sab</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">target</span>, <span class="va">feature</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  max_bins <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  initial_temperature <span class="op">=</span> <span class="fl">2.0</span>,</span></span>
<span class="r-in"><span>  cooling_rate <span class="op">=</span> <span class="fl">0.99</span>,</span></span>
<span class="r-in"><span>  max_iterations <span class="op">=</span> <span class="fl">2000</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lopes J. E.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

