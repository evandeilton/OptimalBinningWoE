<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Optimal Binning for Numerical Features Using Monotonic Binning via Linear Programming — ob_numerical_mblp • OptimalBinningWoE</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimal Binning for Numerical Features Using Monotonic Binning via Linear Programming — ob_numerical_mblp"><meta name="description" content='Implements a greedy optimization algorithm for supervised discretization of
numerical features with **guaranteed monotonicity** in Weight of Evidence (WoE).
Despite the "Linear Programming" designation, this method employs an iterative
heuristic based on quantile pre-binning, Information Value (IV) optimization,
and monotonicity enforcement through adaptive bin merging.
Important Note: This algorithm does not use formal Linear Programming
solvers (e.g., simplex method). The name reflects the conceptual formulation
of binning as a constrained optimization problem, but the implementation uses
a deterministic greedy heuristic for computational efficiency.'><meta property="og:description" content='Implements a greedy optimization algorithm for supervised discretization of
numerical features with **guaranteed monotonicity** in Weight of Evidence (WoE).
Despite the "Linear Programming" designation, this method employs an iterative
heuristic based on quantile pre-binning, Information Value (IV) optimization,
and monotonicity enforcement through adaptive bin merging.
Important Note: This algorithm does not use formal Linear Programming
solvers (e.g., simplex method). The name reflects the conceptual formulation
of binning as a constrained optimization problem, but the implementation uses
a deterministic greedy heuristic for computational efficiency.'><meta property="og:image" content="https://evandeilton.github.io/OptimalBinningWoE/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OptimalBinningWoE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">OptimalBinningWoE: Practical Guide for Credit Risk Modeling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/evandeilton/OptimalBinningWoE/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Optimal Binning for Numerical Features Using Monotonic Binning via Linear Programming</h1>
      <small class="dont-index">Source: <a href="https://github.com/evandeilton/OptimalBinningWoE/blob/v1.0.8/R/obn_mblp.R" class="external-link"><code>R/obn_mblp.R</code></a></small>
      <div class="d-none name"><code>ob_numerical_mblp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Implements a greedy optimization algorithm for supervised discretization of
numerical features with **guaranteed monotonicity** in Weight of Evidence (WoE).
Despite the "Linear Programming" designation, this method employs an iterative
heuristic based on quantile pre-binning, Information Value (IV) optimization,
and monotonicity enforcement through adaptive bin merging.</p>
<p><strong>Important Note</strong>: This algorithm does not use formal Linear Programming
solvers (e.g., simplex method). The name reflects the conceptual formulation
of binning as a constrained optimization problem, but the implementation uses
a deterministic greedy heuristic for computational efficiency.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ob_numerical_mblp</span><span class="op">(</span></span>
<span>  <span class="va">feature</span>,</span>
<span>  <span class="va">target</span>,</span>
<span>  min_bins <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  max_bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  bin_cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  max_n_prebins <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  force_monotonic_direction <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  convergence_threshold <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-feature">feature<a class="anchor" aria-label="anchor" href="#arg-feature"></a></dt>
<dd><p>Numeric vector of feature values to be binned. Missing values (NA)
and infinite values are automatically removed during preprocessing.</p></dd>


<dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p>Integer vector of binary target values (must contain only 0 and 1).
Must have the same length as <code>feature</code>.</p></dd>


<dt id="arg-min-bins">min_bins<a class="anchor" aria-label="anchor" href="#arg-min-bins"></a></dt>
<dd><p>Minimum number of bins to generate (default: 3). Must be at least 2.</p></dd>


<dt id="arg-max-bins">max_bins<a class="anchor" aria-label="anchor" href="#arg-max-bins"></a></dt>
<dd><p>Maximum number of bins to generate (default: 5). Must be greater
than or equal to <code>min_bins</code>.</p></dd>


<dt id="arg-bin-cutoff">bin_cutoff<a class="anchor" aria-label="anchor" href="#arg-bin-cutoff"></a></dt>
<dd><p>Minimum fraction of total observations in each bin (default: 0.05).
Bins with frequency below this threshold are merged with adjacent bins. Must be
in the range (0, 1).</p></dd>


<dt id="arg-max-n-prebins">max_n_prebins<a class="anchor" aria-label="anchor" href="#arg-max-n-prebins"></a></dt>
<dd><p>Maximum number of pre-bins before optimization (default: 20).
Controls granularity of initial quantile-based discretization.</p></dd>


<dt id="arg-force-monotonic-direction">force_monotonic_direction<a class="anchor" aria-label="anchor" href="#arg-force-monotonic-direction"></a></dt>
<dd><p>Integer flag to force a specific monotonicity
direction (default: 0). Valid values:</p><ul><li><p><code>0</code>: Automatically determine direction via correlation between
    bin indices and WoE values.</p></li>
<li><p><code>1</code>: Force increasing monotonicity (WoE increases with feature value).</p></li>
<li><p><code>-1</code>: Force decreasing monotonicity (WoE decreases with feature value).</p></li>
</ul></dd>


<dt id="arg-convergence-threshold">convergence_threshold<a class="anchor" aria-label="anchor" href="#arg-convergence-threshold"></a></dt>
<dd><p>Convergence threshold for iterative optimization
(default: 1e-6). Iteration stops when the absolute change in total IV between
consecutive iterations falls below this value.</p></dd>


<dt id="arg-max-iterations">max_iterations<a class="anchor" aria-label="anchor" href="#arg-max-iterations"></a></dt>
<dd><p>Maximum number of iterations for the optimization loop
(default: 1000). Prevents infinite loops in pathological cases.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing:</p><dl><dt>id</dt>
<dd><p>Integer vector of bin identifiers (1-based indexing).</p></dd>

  <dt>bin</dt>
<dd><p>Character vector of bin intervals in the format <code>"(lower;upper]"</code>.</p></dd>

  <dt>woe</dt>
<dd><p>Numeric vector of Weight of Evidence values for each bin.</p></dd>

  <dt>iv</dt>
<dd><p>Numeric vector of Information Value contributions for each bin.</p></dd>

  <dt>count</dt>
<dd><p>Integer vector of total observations in each bin.</p></dd>

  <dt>count_pos</dt>
<dd><p>Integer vector of positive class (target = 1) counts per bin.</p></dd>

  <dt>count_neg</dt>
<dd><p>Integer vector of negative class (target = 0) counts per bin.</p></dd>

  <dt>event_rate</dt>
<dd><p>Numeric vector of event rates (proportion of positives) per bin.</p></dd>

  <dt>cutpoints</dt>
<dd><p>Numeric vector of cutpoints defining bin boundaries (excluding
    -Inf and +Inf).</p></dd>

  <dt>converged</dt>
<dd><p>Logical flag indicating whether the algorithm converged within
    <code>max_iterations</code>.</p></dd>

  <dt>iterations</dt>
<dd><p>Integer count of iterations performed during optimization.</p></dd>

  <dt>total_iv</dt>
<dd><p>Numeric scalar representing the total Information Value
    (sum of all bin IVs).</p></dd>

  <dt>monotonicity</dt>
<dd><p>Character string indicating monotonicity status: <code>"increasing"</code>,
    <code>"decreasing"</code>, or <code>"none"</code>.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Algorithm Overview</strong></p>
<p>The Monotonic Binning via Linear Programming (MBLP) algorithm operates in four
sequential phases designed to balance predictive power (IV maximization) and
interpretability (monotonic WoE):</p>
<p><strong>Phase 1: Quantile-Based Pre-binning</strong></p>
<p>Initial bin boundaries are determined using empirical quantiles of the feature
distribution. For \(k\) pre-bins, cutpoints are computed as:</p>
<p>$$q_i = x_{(\lceil p_i \times (N - 1) \rceil)}, \quad p_i = \frac{i}{k}, \quad i = 1, 2, \ldots, k-1$$</p>
<p>where \(x_{(j)}\) denotes the \(j\)-th order statistic. This approach ensures
equal-frequency bins under the assumption of continuous data, though ties may
cause deviations in practice. The first and last boundaries are set to
\(-\infty\) and \(+\infty\), respectively.</p>
<p><strong>Phase 2: Frequency-Based Bin Merging</strong></p>
<p>Bins with total count below <code>bin_cutoff</code> \(\times N\) are iteratively
merged with adjacent bins to ensure statistical reliability. The merge strategy
selects the neighbor with the smallest count (greedy heuristic), continuing
until all bins meet the frequency threshold or <code>min_bins</code> is reached.</p>
<p><strong>Phase 3: Monotonicity Direction Determination</strong></p>
<p>If <code>force_monotonic_direction = 0</code>, the algorithm computes the Pearson
correlation between bin indices and WoE values:</p>
<p>$$\rho = \frac{\sum_{i=1}^{k} (i - \bar{i})(\text{WoE}_i - \overline{\text{WoE}})}{\sqrt{\sum_{i=1}^{k} (i - \bar{i})^2 \sum_{i=1}^{k} (\text{WoE}_i - \overline{\text{WoE}})^2}}$$</p>
<p>The monotonicity direction is set as:
$$\text{direction} = \begin{cases} 1 &amp; \text{if } \rho \ge 0 \text{ (increasing)} \\ -1 &amp; \text{if } \rho &lt; 0 \text{ (decreasing)} \end{cases}$$</p>
<p>If <code>force_monotonic_direction</code> is explicitly set to 1 or -1, that value
overrides the correlation-based determination.</p>
<p><strong>Phase 4: Iterative Optimization Loop</strong></p>
<p>The core optimization alternates between two enforcement steps until convergence:</p>
<ol><li><p><strong>Cardinality Constraint</strong>: If the number of bins \(k\) exceeds
    <code>max_bins</code>, the algorithm identifies the pair of adjacent bins
    \((i, i+1)\) that minimizes the IV loss when merged:
    $$\Delta \text{IV}_{i,i+1} = \text{IV}_i + \text{IV}_{i+1} - \text{IV}_{\text{merged}}$$
    where \(\text{IV}_{\text{merged}}\) is recalculated using combined counts.
    The merge is performed only if it preserves monotonicity (checked via WoE
    comparison with neighboring bins).</p></li>
<li><p><strong>Monotonicity Enforcement</strong>: For each pair of consecutive bins,
    violations are detected as:</p><ul><li><p><strong>Increasing</strong>: \(\text{WoE}_i &lt; \text{WoE}_{i-1} - \epsilon\)</p></li>
<li><p><strong>Decreasing</strong>: \(\text{WoE}_i &gt; \text{WoE}_{i-1} + \epsilon\)</p></li>
</ul><p>where \(\epsilon = 10^{-10}\) (numerical tolerance). Violating bins are
    immediately merged.</p></li>
<li><p><strong>Convergence Test</strong>: After each iteration, the total IV is compared
    to the previous iteration. If \(|\text{IV}^{(t)} - \text{IV}^{(t-1)}| &lt; \text{convergence\_threshold}\)
    or monotonicity is achieved, the loop terminates.</p></li>
</ol><p><strong>Weight of Evidence Computation</strong></p>
<p>WoE for bin \(i\) uses Laplace smoothing (\(\alpha = 0.5\)) to handle zero counts:</p>
<p>$$\text{WoE}_i = \ln\left(\frac{\text{DistGood}_i}{\text{DistBad}_i}\right)$$</p>
<p>where:
$$\text{DistGood}_i = \frac{n_i^{+} + \alpha}{n^{+} + k\alpha}, \quad \text{DistBad}_i = \frac{n_i^{-} + \alpha}{n^{-} + k\alpha}$$</p>
<p>and \(k\) is the current number of bins. The Information Value contribution is:</p>
<p>$$\text{IV}_i = (\text{DistGood}_i - \text{DistBad}_i) \times \text{WoE}_i$$</p>
<p><strong>Theoretical Foundations</strong></p>
<ul><li><p><strong>Monotonicity Requirement</strong>: Zeng (2014) proves that monotonic WoE
    is a necessary condition for stable scorecards under data drift. Non-monotonic
    patterns often indicate overfitting to noise.</p></li>
<li><p><strong>Greedy Optimization</strong>: Unlike global optimizers (MILP), greedy
    heuristics provide no optimality guarantees but achieve O(k²) complexity
    per iteration versus exponential for exact methods.</p></li>
<li><p><strong>Quantile Binning</strong>: Ensures initial bins have approximately equal
    sample sizes, reducing variance in WoE estimates (especially critical for
    minority classes).</p></li>
</ul><p><strong>Comparison with True Linear Programming</strong></p>
<p>Formal LP formulations for binning (Belotti et al., 2016) express the problem as:</p>
<p>$$\max_{\mathbf{z}, \mathbf{b}} \sum_{i=1}^{k} \text{IV}_i(\mathbf{b})$$</p>
<p>subject to:
$$\text{WoE}_i \le \text{WoE}_{i+1} \quad \forall i \quad \text{(monotonicity)}$$
$$\sum_{j=1}^{N} z_{ij} = 1 \quad \forall j \quad \text{(assignment)}$$
$$z_{ij} \in \{0, 1\}, \quad b_i \in \mathbb{R}$$</p>
<p>where \(z_{ij}\) indicates if observation \(j\) is in bin \(i\), and
\(b_i\) are bin boundaries. Such formulations require MILP solvers (CPLEX,
Gurobi) and scale poorly beyond \(N &gt; 10^4\). MBLP sacrifices global optimality
for <strong>scalability</strong> and <strong>determinism</strong>.</p>
<p><strong>Computational Complexity</strong></p>
<ul><li><p>Initial sorting: \(O(N \log N)\)</p></li>
<li><p>Quantile computation: \(O(k)\)</p></li>
<li><p>Per-iteration operations: \(O(k^2)\) (pairwise comparisons for merging)</p></li>
<li><p>Total: \(O(N \log N + k^2 \times \text{max\_iterations})\)</p></li>
</ul><p>For typical credit scoring datasets (\(N \sim 10^5\), \(k \sim 5\)),
runtime is dominated by sorting. Pathological cases (highly non-monotonic data)
may require many iterations to enforce monotonicity.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Zeng, G. (2014). "A Necessary Condition for a Good Binning Algorithm in
    Credit Scoring". <em>Applied Mathematical Sciences</em>, 8(65), 3229-3242.</p></li>
<li><p>Mironchyk, P., &amp; Tchistiakov, V. (2017). "Monotone optimal binning
    algorithm for credit risk modeling". <em>Frontiers in Applied Mathematics
    and Statistics</em>, 3, 2.</p></li>
<li><p>Belotti, P., Bonami, P., Fischetti, M., Lodi, A., Monaci, M.,
    Nogales-Gómez, A., &amp; Salvagnin, D. (2016). "On handling indicator constraints
    in mixed integer programming". <em>Computational Optimization and Applications</em>,
    65(3), 545-566.</p></li>
<li><p>Thomas, L. C., Edelman, D. B., &amp; Crook, J. N. (2002). <em>Credit Scoring
    and Its Applications</em>. SIAM.</p></li>
<li><p>Louzada, F., Ara, A., &amp; Fernandes, G. B. (2016). "Classification methods
    applied to credit scoring: Systematic review and overall comparison". <em>Surveys
    in Operations Research and Management Science</em>, 21(2), 117-134.</p></li>
<li><p>Naeem, B., Huda, N., &amp; Aziz, A. (2013). "Developing Scorecards with
    Constrained Logistic Regression". <em>Proceedings of the International Workshop
    on Data Mining Applications</em>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="ob_numerical_ldb.html">ob_numerical_ldb</a></code> for density-based binning,
<code><a href="ob_numerical_mdlp.html">ob_numerical_mdlp</a></code> for entropy-based discretization with MDLP criterion.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Lopes, J. E. (implemented algorithm based on Mironchyk &amp; Tchistiakov, 2017)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Simulate non-monotonic credit scoring data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">8000</span></span></span>
<span class="r-in"><span><span class="va">feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2000</span>, mean <span class="op">=</span> <span class="fl">550</span>, sd <span class="op">=</span> <span class="fl">60</span><span class="op">)</span>, <span class="co"># High-risk segment (low scores)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">3000</span>, mean <span class="op">=</span> <span class="fl">680</span>, sd <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>, <span class="co"># Medium-risk segment</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2000</span>, mean <span class="op">=</span> <span class="fl">720</span>, sd <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>, <span class="co"># Low-risk segment</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>, mean <span class="op">=</span> <span class="fl">620</span>, sd <span class="op">=</span> <span class="fl">55</span><span class="op">)</span> <span class="co"># Mixed segment (creates non-monotonicity)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span>, <span class="co"># 25% default rate</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">3000</span>, <span class="fl">1</span>, <span class="fl">0.10</span><span class="op">)</span>, <span class="co"># 10% default rate</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">1</span>, <span class="fl">0.03</span><span class="op">)</span>, <span class="co"># 3% default rate</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1</span>, <span class="fl">0.15</span><span class="op">)</span> <span class="co"># 15% default rate (violates monotonicity)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Apply MBLP with automatic monotonicity detection</span></span></span>
<span class="r-in"><span><span class="va">result_auto</span> <span class="op">&lt;-</span> <span class="fu">ob_numerical_mblp</span><span class="op">(</span></span></span>
<span class="r-in"><span>  feature <span class="op">=</span> <span class="va">feature</span>,</span></span>
<span class="r-in"><span>  target <span class="op">=</span> <span class="va">target</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  max_bins <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  bin_cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>  max_n_prebins <span class="op">=</span> <span class="fl">20</span>,</span></span>
<span class="r-in"><span>  force_monotonic_direction <span class="op">=</span> <span class="fl">0</span> <span class="co"># Auto-detect</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_auto</span><span class="op">$</span><span class="va">monotonicity</span><span class="op">)</span> <span class="co"># Check detected direction</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "decreasing"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_auto</span><span class="op">$</span><span class="va">total_iv</span><span class="op">)</span> <span class="co"># Should be &gt; 0.1 for predictive features</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.2360193</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Force decreasing monotonicity (higher score = lower WoE = lower risk)</span></span></span>
<span class="r-in"><span><span class="va">result_forced</span> <span class="op">&lt;-</span> <span class="fu">ob_numerical_mblp</span><span class="op">(</span></span></span>
<span class="r-in"><span>  feature <span class="op">=</span> <span class="va">feature</span>,</span></span>
<span class="r-in"><span>  target <span class="op">=</span> <span class="va">target</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  max_bins <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  force_monotonic_direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="co"># Force decreasing</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Verify monotonicity enforcement</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">result_forced</span><span class="op">$</span><span class="va">woe</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1e-9</span><span class="op">)</span><span class="op">)</span> <span class="co"># Should be non-increasing</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compare convergence</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"Auto mode: %d iterations, IV = %.4f\n"</span>,</span></span>
<span class="r-in"><span>  <span class="va">result_auto</span><span class="op">$</span><span class="va">iterations</span>, <span class="va">result_auto</span><span class="op">$</span><span class="va">total_iv</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Auto mode: 2 iterations, IV = 0.2360</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"Forced mode: %d iterations, IV = %.4f\n"</span>,</span></span>
<span class="r-in"><span>  <span class="va">result_forced</span><span class="op">$</span><span class="va">iterations</span>, <span class="va">result_forced</span><span class="op">$</span><span class="va">total_iv</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Forced mode: 2 iterations, IV = 0.2658</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Visualize binning quality</span></span></span>
<span class="r-in"><span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result_auto</span><span class="op">$</span><span class="va">woe</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="st">"blue"</span>, pch <span class="op">=</span> <span class="fl">19</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="st">"Bin"</span>, ylab <span class="op">=</span> <span class="st">"WoE"</span>, main <span class="op">=</span> <span class="st">"Auto-Detected Monotonicity"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result_forced</span><span class="op">$</span><span class="va">woe</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">19</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="st">"Bin"</span>, ylab <span class="op">=</span> <span class="st">"WoE"</span>, main <span class="op">=</span> <span class="st">"Forced Decreasing"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ob_numerical_mblp-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by José Evandeilton Lopes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

