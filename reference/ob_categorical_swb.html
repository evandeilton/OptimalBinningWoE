<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Optimal Binning for Categorical Variables using Sliding Window Binning (SWB) — ob_categorical_swb • OptimalBinningWoE</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimal Binning for Categorical Variables using Sliding Window Binning (SWB) — ob_categorical_swb"><meta name="description" content="This function performs optimal binning for categorical variables using the
Sliding Window Binning (SWB) algorithm. This approach combines initial
grouping based on frequency thresholds with iterative optimization to achieve
monotonic Weight of Evidence (WoE) while maximizing Information Value (IV)."><meta property="og:description" content="This function performs optimal binning for categorical variables using the
Sliding Window Binning (SWB) algorithm. This approach combines initial
grouping based on frequency thresholds with iterative optimization to achieve
monotonic Weight of Evidence (WoE) while maximizing Information Value (IV)."><meta property="og:image" content="https://evandeilton.github.io/OptimalBinningWoE/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OptimalBinningWoE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">OptimalBinningWoE: Practical Guide for Credit Risk Modeling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/evandeilton/OptimalBinningWoE/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Optimal Binning for Categorical Variables using Sliding Window Binning (SWB)</h1>
      <small class="dont-index">Source: <a href="https://github.com/evandeilton/OptimalBinningWoE/blob/v1.0.7/R/obc_swb.R" class="external-link"><code>R/obc_swb.R</code></a></small>
      <div class="d-none name"><code>ob_categorical_swb.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function performs optimal binning for categorical variables using the
Sliding Window Binning (SWB) algorithm. This approach combines initial
grouping based on frequency thresholds with iterative optimization to achieve
monotonic Weight of Evidence (WoE) while maximizing Information Value (IV).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ob_categorical_swb</span><span class="op">(</span></span>
<span>  <span class="va">feature</span>,</span>
<span>  <span class="va">target</span>,</span>
<span>  min_bins <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  max_bins <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>  bin_cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  max_n_prebins <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>  bin_separator <span class="op">=</span> <span class="st">"%;%"</span>,</span>
<span>  convergence_threshold <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="fl">1000L</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-feature">feature<a class="anchor" aria-label="anchor" href="#arg-feature"></a></dt>
<dd><p>A character vector or factor representing the categorical
predictor variable. Missing values (NA) will be converted to the string
"NA" and treated as a separate category.</p></dd>


<dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p>An integer vector containing binary outcome values (0 or 1).
Must be the same length as <code>feature</code>. Cannot contain missing values.</p></dd>


<dt id="arg-min-bins">min_bins<a class="anchor" aria-label="anchor" href="#arg-min-bins"></a></dt>
<dd><p>Integer. Minimum number of bins to create. Must be at least
1. Default is 3.</p></dd>


<dt id="arg-max-bins">max_bins<a class="anchor" aria-label="anchor" href="#arg-max-bins"></a></dt>
<dd><p>Integer. Maximum number of bins to create. Must be greater
than or equal to <code>min_bins</code>. Default is 5.</p></dd>


<dt id="arg-bin-cutoff">bin_cutoff<a class="anchor" aria-label="anchor" href="#arg-bin-cutoff"></a></dt>
<dd><p>Numeric. Minimum relative frequency threshold for
individual categories. Categories with frequency below this proportion
will be grouped together into a single "rare" bin. Value must be between
0 and 1. Default is 0.05 (5%).</p></dd>


<dt id="arg-max-n-prebins">max_n_prebins<a class="anchor" aria-label="anchor" href="#arg-max-n-prebins"></a></dt>
<dd><p>Integer. Maximum number of initial bins created after
the frequency-based grouping step. Used to control early-stage complexity.
Default is 20.</p></dd>


<dt id="arg-bin-separator">bin_separator<a class="anchor" aria-label="anchor" href="#arg-bin-separator"></a></dt>
<dd><p>Character string used to separate category names when
multiple categories are merged into a single bin. Default is "%;%".</p></dd>


<dt id="arg-convergence-threshold">convergence_threshold<a class="anchor" aria-label="anchor" href="#arg-convergence-threshold"></a></dt>
<dd><p>Numeric. Threshold for determining algorithm
convergence based on changes in total Information Value between iterations.
Default is 1e-6.</p></dd>


<dt id="arg-max-iterations">max_iterations<a class="anchor" aria-label="anchor" href="#arg-max-iterations"></a></dt>
<dd><p>Integer. Maximum number of iterations for the
optimization process. Default is 1000.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing the results of the optimal binning procedure:</p><dl><dt><code>id</code></dt>
<dd><p>Numeric vector of bin identifiers (1 to n_bins)</p></dd>

  <dt><code>bin</code></dt>
<dd><p>Character vector of bin labels, which are combinations
        of original categories separated by <code>bin_separator</code></p></dd>

  <dt><code>woe</code></dt>
<dd><p>Numeric vector of Weight of Evidence values for each bin</p></dd>

  <dt><code>iv</code></dt>
<dd><p>Numeric vector of Information Values for each bin</p></dd>

  <dt><code>count</code></dt>
<dd><p>Integer vector of total observations in each bin</p></dd>

  <dt><code>count_pos</code></dt>
<dd><p>Integer vector of positive outcomes in each bin</p></dd>

  <dt><code>count_neg</code></dt>
<dd><p>Integer vector of negative outcomes in each bin</p></dd>

  <dt><code>event_rate</code></dt>
<dd><p>Numeric vector of the observed event rate in each bin</p></dd>

  <dt><code>total_iv</code></dt>
<dd><p>Numeric scalar. Total Information Value across all
        bins</p></dd>

  <dt><code>converged</code></dt>
<dd><p>Logical. Whether the algorithm converged within
        specified tolerances</p></dd>

  <dt><code>iterations</code></dt>
<dd><p>Integer. Number of iterations performed</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The SWB algorithm follows these steps:</p><ol><li><p><strong>Initialization</strong>: Categories are initially grouped based on
        frequency thresholds (<code>bin_cutoff</code>), separating frequent
        categories from rare ones.</p></li>
<li><p><strong>Preprocessing</strong>: Initial bins are sorted by their WoE values
        to establish a baseline ordering.</p></li>
<li><p><strong>Sliding Window Optimization</strong>: An iterative process evaluates
        adjacent bin pairs and merges those that contribute least to the
        overall Information Value or violate monotonicity constraints.</p></li>
<li><p><strong>Constraint Enforcement</strong>: The final binning respects the
        specified <code>min_bins</code> and <code>max_bins</code> limits while
        maintaining WoE monotonicity.</p></li>
</ol><p>Key features of this implementation:</p><ul><li><p><strong>Frequency-based Pre-grouping</strong>: Automatically identifies and
        groups rare categories to reduce dimensionality.</p></li>
<li><p><strong>Statistical Similarity Measures</strong>: Utilizes Jensen-Shannon
        divergence to determine optimal merge candidates.</p></li>
<li><p><strong>Monotonicity Preservation</strong>: Ensures final bins exhibit
        consistent WoE trends (either increasing or decreasing).</p></li>
<li><p><strong>Laplace Smoothing</strong>: Employs additive smoothing to prevent
        numerical instabilities in WoE/IV calculations.</p></li>
</ul><p>Mathematical concepts:</p>
<p>Weight of Evidence (WoE) with Laplace smoothing:
$$WoE = \ln\left(\frac{(p_{pos} + \alpha)/(N_{pos} + 2\alpha)}{(p_{neg} + \alpha)/(N_{neg} + 2\alpha)}\right)$$</p>
<p>Information Value (IV):
$$IV = \left(\frac{p_{pos} + \alpha}{N_{pos} + 2\alpha} - \frac{p_{neg} + \alpha}{N_{neg} + 2\alpha}\right) \times WoE$$</p>
<p>where \(p_{pos}\) and \(p_{neg}\) are bin-level counts, \(N_{pos}\) and
\(N_{neg}\) are dataset-level totals, and \(\alpha\) is the smoothing
parameter (default 0.5).</p>
<p>Jensen-Shannon Divergence between two bins:
$$JSD(P||Q) = \frac{1}{2}\left[KL(P||M) + KL(Q||M)\right]$$
where \(M = \frac{1}{2}(P+Q)\) and \(KL\) represents Kullback-Leibler
divergence.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>

<ul><li><p>Target variable must contain both 0 and 1 values.</p></li>
<li><p>The algorithm prioritizes monotonicity over strict adherence to
        bin count limits when conflicts arise.</p></li>
<li><p>For datasets with very few unique categories (&lt; 3), each category
        forms its own bin without optimization.</p></li>
<li><p>Rare category grouping helps stabilize WoE estimates for infrequent
        values.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Generate sample data with varying category frequencies</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5000</span></span></span>
<span class="r-in"><span><span class="co"># Create categories with power-law frequency distribution</span></span></span>
<span class="r-in"><span><span class="va">categories</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">1500</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="fl">1000</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="fl">800</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="fl">500</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"E"</span>, <span class="fl">300</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="fl">200</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">26</span><span class="op">]</span>, <span class="fl">700</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">categories</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Create target with dependency on top categories</span></span></span>
<span class="r-in"><span><span class="va">target_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">feature</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, <span class="fl">0.7</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">feature</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">target_probs</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Perform sliding window binning</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ob_categorical_swb</span><span class="op">(</span><span class="va">feature</span>, <span class="va">target</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bin"</span>, <span class="st">"woe"</span>, <span class="st">"iv"</span>, <span class="st">"count"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $bin</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "E"                                                                                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "i%;%g%;%y%;%r%;%q%;%l%;%t%;%z%;%w%;%n%;%F%;%k%;%j%;%x%;%m%;%p%;%h%;%u%;%s%;%v%;%o"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "C%;%D"                                                                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "A"                                                                                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "B"                                                                                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $woe</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1.1552050 -1.0541862 -0.1830370  0.6332108  0.6365736</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $iv</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.073747445 0.195525930 0.008783081 0.112135969 0.076546047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $count</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  291  916 1303 1486 1004</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With stricter bin limits</span></span></span>
<span class="r-in"><span><span class="va">result_strict</span> <span class="op">&lt;-</span> <span class="fu">ob_categorical_swb</span><span class="op">(</span></span></span>
<span class="r-in"><span>  feature <span class="op">=</span> <span class="va">feature</span>,</span></span>
<span class="r-in"><span>  target <span class="op">=</span> <span class="va">target</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  max_bins <span class="op">=</span> <span class="fl">6</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Handling missing values</span></span></span>
<span class="r-in"><span><span class="va">feature_with_na</span> <span class="op">&lt;-</span> <span class="va">feature</span></span></span>
<span class="r-in"><span><span class="va">feature_with_na</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">feature_with_na</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="va">result_na</span> <span class="op">&lt;-</span> <span class="fu">ob_categorical_swb</span><span class="op">(</span><span class="va">feature_with_na</span>, <span class="va">target</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by José Evandeilton Lopes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

