<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Optimal Binning for Numerical Variables using Isotonic Regression — optimal_binning_numerical_ir • OptimalBinningWoE</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimal Binning for Numerical Variables using Isotonic Regression — optimal_binning_numerical_ir"><meta name="description" content="Implements an advanced binning algorithm for numerical variables using isotonic regression
to ensure monotonicity in bin event rates. This method is particularly valuable for risk modeling,
credit scoring, and other applications where monotonic relationships between features and
target variables are expected or preferred."><meta property="og:description" content="Implements an advanced binning algorithm for numerical variables using isotonic regression
to ensure monotonicity in bin event rates. This method is particularly valuable for risk modeling,
credit scoring, and other applications where monotonic relationships between features and
target variables are expected or preferred."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OptimalBinningWoE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Optimal Binning for Numerical Variables using Isotonic Regression</h1>

      <div class="d-none name"><code>optimal_binning_numerical_ir.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Implements an advanced binning algorithm for numerical variables using isotonic regression
to ensure monotonicity in bin event rates. This method is particularly valuable for risk modeling,
credit scoring, and other applications where monotonic relationships between features and
target variables are expected or preferred.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">optimal_binning_numerical_ir</span><span class="op">(</span></span>
<span>  <span class="va">target</span>,</span>
<span>  <span class="va">feature</span>,</span>
<span>  min_bins <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  max_bins <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>  bin_cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  max_n_prebins <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>  auto_monotonicity <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  convergence_threshold <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="fl">1000L</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p>Binary integer vector (0 or 1) representing the target variable.</p></dd>


<dt id="arg-feature">feature<a class="anchor" aria-label="anchor" href="#arg-feature"></a></dt>
<dd><p>Numeric vector of values to be binned.</p></dd>


<dt id="arg-min-bins">min_bins<a class="anchor" aria-label="anchor" href="#arg-min-bins"></a></dt>
<dd><p>Minimum number of bins to generate (default: 3).</p></dd>


<dt id="arg-max-bins">max_bins<a class="anchor" aria-label="anchor" href="#arg-max-bins"></a></dt>
<dd><p>Maximum number of bins allowed (default: 5).</p></dd>


<dt id="arg-bin-cutoff">bin_cutoff<a class="anchor" aria-label="anchor" href="#arg-bin-cutoff"></a></dt>
<dd><p>Minimum frequency fraction for each bin (default: 0.05).</p></dd>


<dt id="arg-max-n-prebins">max_n_prebins<a class="anchor" aria-label="anchor" href="#arg-max-n-prebins"></a></dt>
<dd><p>Maximum number of pre-bins before optimization (default: 20).</p></dd>


<dt id="arg-auto-monotonicity">auto_monotonicity<a class="anchor" aria-label="anchor" href="#arg-auto-monotonicity"></a></dt>
<dd><p>Automatically determine monotonicity direction (default: TRUE).</p></dd>


<dt id="arg-convergence-threshold">convergence_threshold<a class="anchor" aria-label="anchor" href="#arg-convergence-threshold"></a></dt>
<dd><p>Convergence threshold for optimization (default: 1e-6).</p></dd>


<dt id="arg-max-iterations">max_iterations<a class="anchor" aria-label="anchor" href="#arg-max-iterations"></a></dt>
<dd><p>Maximum number of iterations allowed (default: 1000).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing:</p>
<dl><dt>id</dt>
<dd><p>Numeric identifiers for each bin (1-based).</p></dd>

<dt>bin</dt>
<dd><p>Character vector with the bin intervals.</p></dd>

<dt>woe</dt>
<dd><p>Numeric vector with Weight of Evidence values for each bin.</p></dd>

<dt>iv</dt>
<dd><p>Numeric vector with Information Value contribution for each bin.</p></dd>

<dt>count</dt>
<dd><p>Integer vector with the total number of observations in each bin.</p></dd>

<dt>count_pos</dt>
<dd><p>Integer vector with the positive class counts in each bin.</p></dd>

<dt>count_neg</dt>
<dd><p>Integer vector with the negative class counts in each bin.</p></dd>

<dt>cutpoints</dt>
<dd><p>Numeric vector with the bin cutpoints (excluding ±Inf).</p></dd>

<dt>converged</dt>
<dd><p>Logical value indicating whether the algorithm converged.</p></dd>

<dt>iterations</dt>
<dd><p>Integer with the number of optimization iterations performed.</p></dd>

<dt>total_iv</dt>
<dd><p>Total Information Value of the binning solution.</p></dd>

<dt>monotone_increasing</dt>
<dd><p>Logical indicating whether monotonically increasing (TRUE) or decreasing (FALSE).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="algorithm-overview">Algorithm Overview<a class="anchor" aria-label="anchor" href="#algorithm-overview"></a></h3>


<p>The algorithm transforms a continuous feature into discrete bins that maximize the relationship
with a binary target while enforcing monotonicity constraints. It operates through several phases:</p><ol><li><p><strong>Pre-Binning</strong>: Initial segmentation based on quantiles or unique feature values</p></li>
<li><p><strong>Frequency Stabilization</strong>: Merging of low-frequency bins to ensure statistical reliability</p></li>
<li><p><strong>Monotonicity Enforcement</strong>: Application of isotonic regression via Pool Adjacent Violators (PAV)</p></li>
<li><p><strong>Bin Optimization</strong>: Adjustments to meet constraints on minimum and maximum bin count</p></li>
<li><p><strong>Information Value Calculation</strong>: Computation of WoE and IV metrics for each bin</p></li>
</ol></div>

<div class="section">
<h3 id="mathematical-foundation">Mathematical Foundation<a class="anchor" aria-label="anchor" href="#mathematical-foundation"></a></h3>


<p>The core mathematical concepts employed in this algorithm are:</p><div class="section">
<h4 id="-isotonic-regression">1. Isotonic Regression<a class="anchor" aria-label="anchor" href="#-isotonic-regression"></a></h4>


<p>Isotonic regression solves the following optimization problem:</p>
<p>$$\min_{\mu} \sum_{i=1}^{n} w_i (y_i - \mu_i)^2$$</p>
<p>Subject to:
$$\mu_1 \leq \mu_2 \leq \ldots \leq \mu_n$$ (for increasing monotonicity)</p>
<p>Where:</p><ul><li><p>\(y_i\) is the original event rate in bin \(i\)</p></li>
<li><p>\(w_i\) is the weight (observation count) of bin \(i\)</p></li>
<li><p>\(\mu_i\) is the isotonic (monotone) estimate for bin \(i\)</p></li>
</ul></div>

<div class="section">
<h4 id="-weight-of-evidence-woe-">2. Weight of Evidence (WoE)<a class="anchor" aria-label="anchor" href="#-weight-of-evidence-woe-"></a></h4>


<p>For each bin \(i\), the Weight of Evidence is defined as:</p>
<p>$$WoE_i = \ln\left(\frac{p_i/P}{n_i/N}\right)$$</p>
<p>Where:</p><ul><li><p>\(p_i\): Number of positive cases in bin \(i\)</p></li>
<li><p>\(P\): Total number of positive cases</p></li>
<li><p>\(n_i\): Number of negative cases in bin \(i\)</p></li>
<li><p>\(N\): Total number of negative cases</p></li>
</ul></div>

<div class="section">
<h4 id="-information-value-iv-">3. Information Value (IV)<a class="anchor" aria-label="anchor" href="#-information-value-iv-"></a></h4>


<p>For each bin \(i\), the Information Value contribution is:</p>
<p>$$IV_i = \left(\frac{p_i}{P} - \frac{n_i}{N}\right) \times WoE_i$$</p>
<p>The total Information Value is:</p>
<p>$$IV_{total} = \sum_{i=1}^{k} IV_i$$</p>
</div>

<div class="section">
<h4 id="-laplace-smoothing">4. Laplace Smoothing<a class="anchor" aria-label="anchor" href="#-laplace-smoothing"></a></h4>


<p>To handle zero counts, Laplace smoothing is applied:</p>
<p>$$\frac{p_i + \alpha}{P + k\alpha}, \frac{n_i + \alpha}{N + k\alpha}$$</p>
<p>Where:</p><ul><li><p>\(\alpha\): Smoothing factor (0.5 in this implementation)</p></li>
<li><p>\(k\): Number of bins</p></li>
</ul></div>


</div>

<div class="section">
<h3 id="key-features">Key Features<a class="anchor" aria-label="anchor" href="#key-features"></a></h3>

<ul><li><p><strong>Automatic Monotonicity Direction</strong>: Determines optimal monotonicity (increasing/decreasing) based on data</p></li>
<li><p><strong>Robust Handling of Edge Cases</strong>: Special processing for few unique values, missing data, etc.</p></li>
<li><p><strong>Optimal Information Preservation</strong>: Merges bins to minimize information loss while meeting constraints</p></li>
<li><p><strong>Statistical Reliability</strong>: Ensures each bin has sufficient observations for stable estimates</p></li>
</ul></div>

    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Barlow, R. E., &amp; Brunk, H. D. (1972). The isotonic regression problem and its dual.
<em>Journal of the American Statistical Association</em>, 67(337), 140-147.</p>
<p>Robertson, T., Wright, F. T., &amp; Dykstra, R. L. (1988). <em>Order restricted statistical inference</em>.
Wiley.</p>
<p>de Leeuw, J., Hornik, K., &amp; Mair, P. (2009). Isotone optimization in R: pool-adjacent-violators
algorithm (PAVA) and active set methods. <em>Journal of Statistical Software</em>, 32(5), 1-24.</p>
<p>Siddiqi, N. (2006). <em>Credit Risk Scorecards: Developing and Implementing Intelligent Credit Scoring</em>.
John Wiley &amp; Sons.</p>
<p>Thomas, L. C., Edelman, D. B., &amp; Crook, J. N. (2002). <em>Credit Scoring and Its Applications</em>.
Society for Industrial and Applied Mathematics.</p>
<p>Belkin, M., Hsu, D., &amp; Mitra, P. (2018). Overfitting or perfect fitting? Risk bounds for
classification and regression rules that interpolate. <em>Advances in Neural Information Processing Systems</em>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Generate synthetic data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Basic usage</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">optimal_binning_numerical_ir</span><span class="op">(</span><span class="va">target</span>, <span class="va">feature</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom settings</span></span></span>
<span class="r-in"><span><span class="va">result_custom</span> <span class="op">&lt;-</span> <span class="fu">optimal_binning_numerical_ir</span><span class="op">(</span></span></span>
<span class="r-in"><span>  target <span class="op">=</span> <span class="va">target</span>,</span></span>
<span class="r-in"><span>  feature <span class="op">=</span> <span class="va">feature</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  max_bins <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  bin_cutoff <span class="op">=</span> <span class="fl">0.03</span>,</span></span>
<span class="r-in"><span>  auto_monotonicity <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access specific components</span></span></span>
<span class="r-in"><span><span class="va">bins</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">bin</span></span></span>
<span class="r-in"><span><span class="va">woe_values</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">woe</span></span></span>
<span class="r-in"><span><span class="va">is_increasing</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">monotone_increasing</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lopes J. E.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

