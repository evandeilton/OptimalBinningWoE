<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Optimal Binning for Categorical Variables using Similarity-Based Logistic Partitioning (SBLP) — optimal_binning_categorical_sblp • OptimalBinningWoE</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimal Binning for Categorical Variables using Similarity-Based Logistic Partitioning (SBLP) — optimal_binning_categorical_sblp"><meta name="description" content="This function implements an advanced optimal binning algorithm for categorical variables using
a Similarity-Based Logistic Partitioning (SBLP) approach. It groups categorical predictors into bins
that maximize the Information Value (IV) while maintaining monotonicity with respect to target rates.
The algorithm is designed to handle various edge cases including rare categories, missing values,
and numerical stability issues."><meta property="og:description" content="This function implements an advanced optimal binning algorithm for categorical variables using
a Similarity-Based Logistic Partitioning (SBLP) approach. It groups categorical predictors into bins
that maximize the Information Value (IV) while maintaining monotonicity with respect to target rates.
The algorithm is designed to handle various edge cases including rare categories, missing values,
and numerical stability issues."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OptimalBinningWoE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Optimal Binning for Categorical Variables using Similarity-Based Logistic Partitioning (SBLP)</h1>

      <div class="d-none name"><code>optimal_binning_categorical_sblp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function implements an advanced optimal binning algorithm for categorical variables using
a Similarity-Based Logistic Partitioning (SBLP) approach. It groups categorical predictors into bins
that maximize the Information Value (IV) while maintaining monotonicity with respect to target rates.
The algorithm is designed to handle various edge cases including rare categories, missing values,
and numerical stability issues.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">optimal_binning_categorical_sblp</span><span class="op">(</span></span>
<span>  <span class="va">target</span>,</span>
<span>  <span class="va">feature</span>,</span>
<span>  min_bins <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  max_bins <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>  bin_cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  max_n_prebins <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>  convergence_threshold <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>  bin_separator <span class="op">=</span> <span class="st">"%;%"</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p>Integer binary vector (0 or 1) representing the response variable.</p></dd>


<dt id="arg-feature">feature<a class="anchor" aria-label="anchor" href="#arg-feature"></a></dt>
<dd><p>Character vector with the categories of the explanatory variable.</p></dd>


<dt id="arg-min-bins">min_bins<a class="anchor" aria-label="anchor" href="#arg-min-bins"></a></dt>
<dd><p>Minimum number of bins (default: 3).</p></dd>


<dt id="arg-max-bins">max_bins<a class="anchor" aria-label="anchor" href="#arg-max-bins"></a></dt>
<dd><p>Maximum number of bins (default: 5).</p></dd>


<dt id="arg-bin-cutoff">bin_cutoff<a class="anchor" aria-label="anchor" href="#arg-bin-cutoff"></a></dt>
<dd><p>Minimum frequency proportion for a category to be considered as a separate bin (default: 0.05).</p></dd>


<dt id="arg-max-n-prebins">max_n_prebins<a class="anchor" aria-label="anchor" href="#arg-max-n-prebins"></a></dt>
<dd><p>Maximum number of pre-bins before the partitioning process (default: 20).</p></dd>


<dt id="arg-convergence-threshold">convergence_threshold<a class="anchor" aria-label="anchor" href="#arg-convergence-threshold"></a></dt>
<dd><p>Threshold for algorithm convergence (default: 1e-6).</p></dd>


<dt id="arg-max-iterations">max_iterations<a class="anchor" aria-label="anchor" href="#arg-max-iterations"></a></dt>
<dd><p>Maximum number of iterations of the algorithm (default: 1000).</p></dd>


<dt id="arg-bin-separator">bin_separator<a class="anchor" aria-label="anchor" href="#arg-bin-separator"></a></dt>
<dd><p>Separator used to concatenate category names within bins (default: ";").</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Laplace smoothing parameter for WoE/IV calculation (default: 0.5).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing:</p><ul><li><p>id: Numeric vector with bin identifiers.</p></li>
<li><p>bin: String vector with the names of the bins (concatenated categories).</p></li>
<li><p>woe: Numeric vector with the Weight of Evidence (WoE) values for each bin.</p></li>
<li><p>iv: Numeric vector with the Information Value (IV) values for each bin.</p></li>
<li><p>count: Integer vector with the total count of observations in each bin.</p></li>
<li><p>count_pos: Integer vector with the count of positive cases (target=1) in each bin.</p></li>
<li><p>count_neg: Integer vector with the count of negative cases (target=0) in each bin.</p></li>
<li><p>rate: Numeric vector with the event rate for each bin.</p></li>
<li><p>total_iv: Total Information Value (IV) of the binning solution.</p></li>
<li><p>converged: Logical value indicating whether the algorithm converged.</p></li>
<li><p>iterations: Integer value indicating the number of iterations executed.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The SBLP algorithm operates in several phases:</p><ol><li><p><b>Preprocessing Phase</b>:</p><ul><li><p>Computes initial counts and target rates for each category</p></li>
<li><p>Handles missing values by creating a special "MISSING" category</p></li>
<li><p>Identifies and merges rare categories (frequency &lt; bin_cutoff) based on similarity in target rates</p></li>
<li><p>Ensures the number of pre-bins doesn't exceed max_n_prebins by merging similar categories</p></li>
<li><p>Sorts categories by target rate for monotonic processing</p></li>
</ul></li>
<li><p><b>Optimal Binning Phase</b>:</p><ul><li><p>Uses dynamic programming to find the optimal partitioning that maximizes total IV</p></li>
<li><p>The DP recurrence relation is: \(DP[i,j] = \max_{s&lt;i}(DP[s,j-1] + IV(\{s+1,...,i\}))\)</p></li>
<li><p>Efficiently implements the DP algorithm with O(nk) space complexity</p></li>
<li><p>Ensures at least min_bins and at most max_bins through bin splitting/merging</p></li>
</ul></li>
<li><p><b>Refinement Phase</b>:</p><ul><li><p>Checks for monotonicity in WoE/target rates</p></li>
<li><p>Adjusts binning if needed to ensure monotonicity while preserving min_bins</p></li>
<li><p>Uses a two-attempt approach: first merges adjacent non-monotonic bins,
then if still needed, resorts to force-sorting all categories by rate</p></li>
<li><p>Iteratively refines the solution until convergence or max_iterations</p></li>
</ul></li>
<li><p><b>Output Generation Phase</b>:</p><ul><li><p>Applies Laplace smoothing to handle potential zero counts</p></li>
<li><p>Calculates final WoE and IV values with enhanced numerical stability</p></li>
<li><p>Builds output with comprehensive bin statistics</p></li>
</ul></li>
</ol><p><b>Mathematical Formulation</b>:</p>
<p>With Laplace smoothing, Weight of Evidence (WoE) is calculated as:
$$WoE_i = \ln\left(\frac{P(Bin_i|Y=1)}{P(Bin_i|Y=0)}\right) = \ln\left(\frac{(n_{1i} + \alpha)/(n_1 + \alpha k)}{(n_{0i} + \alpha)/(n_0 + \alpha k)}\right)$$</p>
<p>Information Value (IV) for a bin is calculated as:
$$IV_i = (P(Bin_i|Y=1) - P(Bin_i|Y=0)) \times WoE_i = \left(\frac{n_{1i} + \alpha}{n_1 + \alpha k} - \frac{n_{0i} + \alpha}{n_0 + \alpha k}\right) \times WoE_i$$</p>
<p>Total Information Value is the sum of IV for all bins:
$$IVtotal = \sum_{i=1}^{k} IV_i$$</p>
<p>Where:</p><ul><li><p>\(n_{1i}\) is the number of events (target=1) in bin i</p></li>
<li><p>\(n_{0i}\) is the number of non-events (target=0) in bin i</p></li>
<li><p>\(n_1\) is the total number of events</p></li>
<li><p>\(n_0\) is the total number of non-events</p></li>
<li><p>\(\alpha\) is the Laplace smoothing parameter</p></li>
<li><p>\(k\) is the number of bins</p></li>
</ul><p>The algorithm aims to maximize IVtotal while ensuring a monotonic relationship between bins and target rates.</p>
<p><b>Edge Cases Handled</b>:</p><ul><li><p>Empty or all-NA input data</p></li>
<li><p>Single category features</p></li>
<li><p>Highly imbalanced target distributions</p></li>
<li><p>Features with many unique categories</p></li>
<li><p>Categories with zero observations in one target class</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Beltratti, A., Margarita, S., &amp; Terna, P. (1996). Neural Networks for Economic and Financial Modelling. International Thomson Computer Press.</p></li>
<li><p>Siddiqi, N. (2006). Credit Risk Scorecards: Developing and Implementing Intelligent Credit Scoring. Wiley.</p></li>
<li><p>Thomas, L.C. (2009). Consumer Credit Models: Pricing, Profit and Portfolios. Oxford University Press.</p></li>
<li><p>Hand, D.J., &amp; Adams, N.M. (2014). Data Mining for Credit Scoring: State of the Science. Research Handbook on Computational Methods for Credit Scoring, 69-114.</p></li>
<li><p>Kotsiantis, S., &amp; Kanellopoulos, D. (2006). Discretization Techniques: A recent survey. GESTS International Transactions on Computer Science and Engineering, 32(1), 47-58.</p></li>
<li><p>Lin, K., Mandel, M., Dmitriev, P., &amp; Murray, G. (2019). Dynamic Optimization for Predictive Binning. Proceedings of the 13th ACM Conference on Recommender Systems, 242-250.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Basic usage with default parameters</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">1000</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="fl">1000</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, </span></span>
<span class="r-in"><span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">optimal_binning_categorical_sblp</span><span class="op">(</span><span class="va">target</span>, <span class="va">feature</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Handling missing values</span></span></span>
<span class="r-in"><span><span class="va">feature_with_na</span> <span class="op">&lt;-</span> <span class="va">feature</span></span></span>
<span class="r-in"><span><span class="va">feature_with_na</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="fl">50</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="va">result_na</span> <span class="op">&lt;-</span> <span class="fu">optimal_binning_categorical_sblp</span><span class="op">(</span><span class="va">target</span>, <span class="va">feature_with_na</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom parameters for more refined binning</span></span></span>
<span class="r-in"><span><span class="va">result2</span> <span class="op">&lt;-</span> <span class="fu">optimal_binning_categorical_sblp</span><span class="op">(</span></span></span>
<span class="r-in"><span>  target <span class="op">=</span> <span class="va">target</span>,</span></span>
<span class="r-in"><span>  feature <span class="op">=</span> <span class="va">feature</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  max_bins <span class="op">=</span> <span class="fl">8</span>,</span></span>
<span class="r-in"><span>  bin_cutoff <span class="op">=</span> <span class="fl">0.03</span>,</span></span>
<span class="r-in"><span>  max_n_prebins <span class="op">=</span> <span class="fl">15</span>,</span></span>
<span class="r-in"><span>  alpha <span class="op">=</span> <span class="fl">0.1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Handling imbalanced data</span></span></span>
<span class="r-in"><span><span class="va">imbalanced_target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">1000</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">result3</span> <span class="op">&lt;-</span> <span class="fu">optimal_binning_categorical_sblp</span><span class="op">(</span><span class="va">imbalanced_target</span>, <span class="va">feature</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lopes J. E.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

