<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Categorical Optimal Binning with Fisher’s Exact Test — optimal_binning_categorical_fetb • OptimalBinningWoE</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Categorical Optimal Binning with Fisher’s Exact Test — optimal_binning_categorical_fetb"><meta name="description" content="Performs supervised optimal binning of a categorical predictor versus a
binary target by iteratively merging the most similar adjacent bins
according to Fisher’s Exact Test.  The routine returns monotonic
Weight of Evidence (WoE) values and the associated
Information Value (IV), both key metrics in credit‑scoring,
churn prediction and other binary‑response models."><meta property="og:description" content="Performs supervised optimal binning of a categorical predictor versus a
binary target by iteratively merging the most similar adjacent bins
according to Fisher’s Exact Test.  The routine returns monotonic
Weight of Evidence (WoE) values and the associated
Information Value (IV), both key metrics in credit‑scoring,
churn prediction and other binary‑response models."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OptimalBinningWoE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Categorical Optimal Binning with Fisher’s Exact Test</h1>

      <div class="d-none name"><code>optimal_binning_categorical_fetb.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs supervised optimal binning of a <strong>categorical</strong> predictor versus a
<strong>binary</strong> target by iteratively merging the <em>most similar</em> adjacent bins
according to Fisher’s Exact Test.  The routine returns monotonic
<em>Weight of Evidence</em> (WoE) values and the associated
<em>Information Value</em> (IV), both key metrics in credit‑scoring,
churn prediction and other binary‑response models.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">optimal_binning_categorical_fetb</span><span class="op">(</span></span>
<span>  <span class="va">target</span>,</span>
<span>  <span class="va">feature</span>,</span>
<span>  min_bins <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  max_bins <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>  bin_cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  max_n_prebins <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>  convergence_threshold <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>  bin_separator <span class="op">=</span> <span class="st">"%;%"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p><code>integer</code> vector of 0/1 values (length \(N\)).</p></dd>


<dt id="arg-feature">feature<a class="anchor" aria-label="anchor" href="#arg-feature"></a></dt>
<dd><p><code>character</code> vector of categories (length \(N\)).</p></dd>


<dt id="arg-min-bins">min_bins<a class="anchor" aria-label="anchor" href="#arg-min-bins"></a></dt>
<dd><p>Minimum number of final bins.  Default is <code>3</code>.</p></dd>


<dt id="arg-max-bins">max_bins<a class="anchor" aria-label="anchor" href="#arg-max-bins"></a></dt>
<dd><p>Maximum number of final bins.  Default is <code>5</code>.</p></dd>


<dt id="arg-bin-cutoff">bin_cutoff<a class="anchor" aria-label="anchor" href="#arg-bin-cutoff"></a></dt>
<dd><p>Relative frequency threshold below which categories
are folded into the rare‑bin (default <code>0.05</code>).</p></dd>


<dt id="arg-max-n-prebins">max_n_prebins<a class="anchor" aria-label="anchor" href="#arg-max-n-prebins"></a></dt>
<dd><p>Reserved for future use (ignored internally).</p></dd>


<dt id="arg-convergence-threshold">convergence_threshold<a class="anchor" aria-label="anchor" href="#arg-convergence-threshold"></a></dt>
<dd><p>Absolute tolerance for the change in total IV
required to declare convergence (default <code>0.0000001</code>).</p></dd>


<dt id="arg-max-iterations">max_iterations<a class="anchor" aria-label="anchor" href="#arg-max-iterations"></a></dt>
<dd><p>Safety cap for merge iterations (default <code>1000</code>).</p></dd>


<dt id="arg-bin-separator">bin_separator<a class="anchor" aria-label="anchor" href="#arg-bin-separator"></a></dt>
<dd><p>String used to concatenate category labels in the output.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>list</code> with components</p><ul><li><p><code>id</code>           – numeric id of each resulting bin</p></li>
<li><p><code>bin</code>          – concatenated category labels</p></li>
<li><p><code>woe</code>, <code>iv</code> – WoE and IV per bin</p></li>
<li><p><code>count</code>, <code>count_pos</code>, <code>count_neg</code> – bin counts</p></li>
<li><p><code>converged</code>    – logical flag</p></li>
<li><p><code>iterations</code>   – number of merge iterations</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Algorithm outline</strong><br>
Let \(X \in \{\mathcal{C}_1,\dots,\mathcal{C}_K\}\) be a categorical
feature and \(Y\in\{0,1\}\) the target.  For each category
\(\mathcal{C}_k\) compute the contingency table
$$
  \begin{array}{c|cc}
     &amp; Y=1 &amp; Y=0 \\ \hline
  X=\mathcal{C}_k &amp; a_k &amp; b_k
  \end{array}$$
with \(a_k+b_k=n_k\).  Rare categories where
\(n_k &lt; \textrm{cutoff}\times N\) are grouped into a “rare” bin.
The remaining categories start as singleton bins ordered by their WoE:
$$\mathrm{WoE}_k = \log\left(\frac{a_k/T_1}{b_k/T_0}\right)$$
where \(T_1=\sum_k a_k,\; T_0=\sum_k b_k\).  <br><br>
At every iteration the two adjacent bins \(i,i+1\) that maximise the
two‑tail Fisher <em>p‑value</em>
$$p_{i,i+1} = P\!\left(
   \begin{array}{c|cc} &amp; Y=1 &amp; Y=0\\\hline
   \text{bin }i &amp; a_i &amp; b_i\\
   \text{bin }i+1 &amp; a_{i+1}&amp; b_{i+1}
   \end{array}
\right)$$
are merged.  The process stops when either
\(\#\text{bins}\le\texttt{max\_bins}\) or the
change in global IV,
$$\mathrm{IV}= \sum_{\text{bins}} (\tfrac{a}{T_1}-\tfrac{b}{T_0})
                      \log\!\left(\tfrac{a\,T_0}{b\,T_1}\right)$$
is below <code>convergence_threshold</code>.  After each merge a local
<em>monotonicity enforcement</em> step guarantees
\(\mathrm{WoE}_1\le\cdots\le\mathrm{WoE}_m\) (or the reverse).</p>
<p><strong>Complexity</strong><br></p><ul><li><p>Counting pass: \(O(N)\) time and \(O(K)\) memory.</p></li>
<li><p>Merging loop: worst‑case \(O(B^2)\) time where
\(B\le K\) is the initial number of bins;
in practice \(B\ll N\) and the loop is very fast.</p></li>
</ul><p>Overall complexity is \(O(N + B^2)\) time and \(O(K)\) memory.</p>
<p><strong>Statistical background</strong><br>
The use of Fisher’s Exact Test provides an exact
significance measure for 2×2 tables, ensuring the merged bins are those
whose class proportions do not differ significantly.  Monotone WoE
facilitates downstream monotonic logistic regression or scorecard
scaling.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Fisher, R. A. (1922). <em>On the interpretation of \(X^2\) from contingency
tables, and the calculation of P</em>. <em>Journal of the Royal Statistical
Society</em>, <strong>85</strong>, 87‑94.<br>
Hosmer, D. W., &amp; Lemeshow, S. (2000).
<em>Applied Logistic Regression</em> (2nd ed.). Wiley.<br>
Navas‑Palencia, G. (2019).
<em>optbinning: Optimal Binning in Python</em> – documentation v0.19.<br>
Freeman, J. V., &amp; Campbell, M. J. (2007).
<em>The analysis of categorical data: Fisher’s exact test</em>. <em>Significance</em>.<br>
Siddiqi, N. (2012).
<em>Credit Risk Scorecards: Developing and Implementing Intelligent Credit
Scoring</em>. Wiley.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Lopes, J. E.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">## simulated example -------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span>        <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">target</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.3</span><span class="op">)</span>                 <span class="co"># 30 % positives</span></span></span>
<span class="r-in"><span><span class="va">cats</span>     <span class="op">&lt;-</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">probs</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.20</span>, <span class="fl">0.18</span>, <span class="fl">0.15</span>, <span class="fl">0.12</span>, <span class="fl">0.10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">feature</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">cats</span>, <span class="va">n</span>, <span class="cn">TRUE</span>, <span class="va">probs</span><span class="op">)</span>      <span class="co"># imbalanced categories</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">optimal_binning_categorical_fetb</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">target</span>, <span class="va">feature</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">2</span>, max_bins <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  bin_cutoff <span class="op">=</span> <span class="fl">0.02</span>, bin_separator <span class="op">=</span> <span class="st">"|"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ id        : num [1:4] 1 2 3 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ bin       : chr [1:4] "F|D" "B" "A" "E|C"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ woe       : num [1:4] -0.1333 -0.1095 -0.0842 0.2556</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ iv        : num [1:4] 0.00454 0.00225 0.00182 0.01948</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ count     : int [1:4] 263 192 261 284</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ count_pos : int [1:4] 70 52 72 99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ count_neg : int [1:4] 193 140 189 185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ converged : logi TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ iterations: int 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## inspect WoE curve</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">woe</span>, type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">19</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"Bin index"</span>, ylab <span class="op">=</span> <span class="st">"Weight of Evidence"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="optimal_binning_categorical_fetb-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lopes J. E.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

