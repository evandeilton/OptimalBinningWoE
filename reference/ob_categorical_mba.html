<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Optimal Binning for Categorical Variables using Monotonic Binning Algorithm — ob_categorical_mba • OptimalBinningWoE</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimal Binning for Categorical Variables using Monotonic Binning Algorithm — ob_categorical_mba"><meta name="description" content="Performs supervised discretization of categorical variables using the
Monotonic Binning Algorithm (MBA), which enforces strict Weight of Evidence
monotonicity while optimizing Information Value through intelligent bin merging
strategies. This implementation includes Bayesian smoothing for numerical
stability and adaptive thresholding for robust monotonicity enforcement."><meta property="og:description" content="Performs supervised discretization of categorical variables using the
Monotonic Binning Algorithm (MBA), which enforces strict Weight of Evidence
monotonicity while optimizing Information Value through intelligent bin merging
strategies. This implementation includes Bayesian smoothing for numerical
stability and adaptive thresholding for robust monotonicity enforcement."><meta property="og:image" content="https://evandeilton.github.io/OptimalBinningWoE/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OptimalBinningWoE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">OptimalBinningWoE: Practical Guide for Credit Risk Modeling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/evandeilton/OptimalBinningWoE/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Optimal Binning for Categorical Variables using Monotonic Binning Algorithm</h1>
      <small class="dont-index">Source: <a href="https://github.com/evandeilton/OptimalBinningWoE/blob/v1.0.7/R/obc_mba.R" class="external-link"><code>R/obc_mba.R</code></a></small>
      <div class="d-none name"><code>ob_categorical_mba.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs supervised discretization of categorical variables using the
Monotonic Binning Algorithm (MBA), which enforces strict Weight of Evidence
monotonicity while optimizing Information Value through intelligent bin merging
strategies. This implementation includes Bayesian smoothing for numerical
stability and adaptive thresholding for robust monotonicity enforcement.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ob_categorical_mba</span><span class="op">(</span></span>
<span>  <span class="va">feature</span>,</span>
<span>  <span class="va">target</span>,</span>
<span>  min_bins <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  max_bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  bin_cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  max_n_prebins <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  bin_separator <span class="op">=</span> <span class="st">"%;%"</span>,</span>
<span>  convergence_threshold <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-feature">feature<a class="anchor" aria-label="anchor" href="#arg-feature"></a></dt>
<dd><p>A character vector or factor representing the categorical
predictor variable to be binned. Missing values are automatically
converted to the category <code>"NA"</code>.</p></dd>


<dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p>An integer vector of binary outcomes (0/1) corresponding
to each observation in <code>feature</code>. Missing values are not permitted.</p></dd>


<dt id="arg-min-bins">min_bins<a class="anchor" aria-label="anchor" href="#arg-min-bins"></a></dt>
<dd><p>Integer. Minimum number of bins to produce. Must be &gt;= 2.
The algorithm will not merge below this threshold. Defaults to 3.</p></dd>


<dt id="arg-max-bins">max_bins<a class="anchor" aria-label="anchor" href="#arg-max-bins"></a></dt>
<dd><p>Integer. Maximum number of bins to produce. Must be &gt;=
<code>min_bins</code>. The algorithm reduces bins until this constraint is met.
Defaults to 5.</p></dd>


<dt id="arg-bin-cutoff">bin_cutoff<a class="anchor" aria-label="anchor" href="#arg-bin-cutoff"></a></dt>
<dd><p>Numeric. Minimum proportion of total observations required
for a category to remain separate. Categories below this threshold are
pre-merged with similar categories. Must be in (0, 1). Defaults to 0.05.</p></dd>


<dt id="arg-max-n-prebins">max_n_prebins<a class="anchor" aria-label="anchor" href="#arg-max-n-prebins"></a></dt>
<dd><p>Integer. Maximum number of initial bins before the
main optimization phase. Controls computational complexity. Must be &gt;=
<code>max_bins</code>. Defaults to 20.</p></dd>


<dt id="arg-bin-separator">bin_separator<a class="anchor" aria-label="anchor" href="#arg-bin-separator"></a></dt>
<dd><p>Character string used to concatenate category names
when multiple categories are merged into a single bin. Defaults to "%;%".</p></dd>


<dt id="arg-convergence-threshold">convergence_threshold<a class="anchor" aria-label="anchor" href="#arg-convergence-threshold"></a></dt>
<dd><p>Numeric. Convergence tolerance based on
Information Value change between iterations. Algorithm stops when
\(|\Delta IV| &lt;\) <code>convergence_threshold</code>. Must be &gt; 0.
Defaults to 1e-6.</p></dd>


<dt id="arg-max-iterations">max_iterations<a class="anchor" aria-label="anchor" href="#arg-max-iterations"></a></dt>
<dd><p>Integer. Maximum number of optimization iterations.
Prevents infinite loops. Must be &gt; 0. Defaults to 1000.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing the binning results with the following components:</p><dl><dt><code>id</code></dt>
<dd><p>Integer vector of bin identifiers (1-indexed)</p></dd>

    <dt><code>bin</code></dt>
<dd><p>Character vector of bin labels (merged category names)</p></dd>

    <dt><code>woe</code></dt>
<dd><p>Numeric vector of Weight of Evidence values per bin</p></dd>

    <dt><code>iv</code></dt>
<dd><p>Numeric vector of Information Value contribution per bin</p></dd>

    <dt><code>count</code></dt>
<dd><p>Integer vector of total observations per bin</p></dd>

    <dt><code>count_pos</code></dt>
<dd><p>Integer vector of positive cases (target=1) per bin</p></dd>

    <dt><code>count_neg</code></dt>
<dd><p>Integer vector of negative cases (target=0) per bin</p></dd>

    <dt><code>total_iv</code></dt>
<dd><p>Numeric total Information Value of the binning solution</p></dd>

    <dt><code>converged</code></dt>
<dd><p>Logical indicating algorithm convergence</p></dd>

    <dt><code>iterations</code></dt>
<dd><p>Integer count of optimization iterations performed</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The Monotonic Binning Algorithm (MBA) implements a sophisticated approach to
categorical binning that guarantees strict Weight of Evidence monotonicity
through intelligent violation detection and repair mechanisms.</p>
<p><strong>Algorithm Workflow:</strong></p><ol><li><p>Input validation and preprocessing</p></li>
<li><p>Initial bin creation (one category per bin)</p></li>
<li><p>Pre-binning limitation to <code>max_n_prebins</code></p></li>
<li><p>Rare category merging (frequencies &lt; <code>bin_cutoff</code>)</p></li>
<li><p>Bayesian-smoothed WoE calculation</p></li>
<li><p>Strict monotonicity enforcement with adaptive thresholds</p></li>
<li><p>IV-optimized bin merging to meet <code>max_bins</code> constraint</p></li>
<li><p>Final consistency verification</p></li>
</ol><p><strong>Monotonicity Enforcement:</strong></p>
<p>MBA enforces strict monotonicity through an iterative repair process:</p>
<ol><li><p>Sort bins by current WoE values</p></li>
<li><p>Calculate adaptive threshold: \(\tau = \min(\epsilon, 0.01\bar{\Delta})\)</p></li>
<li><p>Identify violations: \(sign(WoE_i - WoE_{i-1}) \neq sign(WoE_{i+1} - WoE_i)\)</p></li>
<li><p>Rank violations by severity: \(s_i = |WoE_i - WoE_{i-1}| + |WoE_{i+1} - WoE_i|\)</p></li>
<li><p>Repair most severe violations by merging adjacent bins</p></li>
<li><p>Repeat until no violations remain or <code>min_bins</code> reached</p></li>
</ol><p><strong>Bayesian Smoothing:</strong></p>
<p>To ensure numerical stability and prevent overfitting, MBA applies Bayesian
smoothing to WoE and IV calculations:</p>
<p>$$p'_i = \frac{n_{i,pos} + \alpha_p}{N_{pos} + \alpha_{total}}$$
$$n'_i = \frac{n_{i,neg} + \alpha_n}{N_{neg} + \alpha_{total}}$$</p>
<p>where priors are proportional to overall prevalence:</p>
<p>$$\alpha_p = \alpha_{total} \times \frac{N_{pos}}{N_{pos} + N_{neg}}$$
$$\alpha_n = \alpha_{total} - \alpha_p$$</p>
<p>with \(\alpha_{total} = 1.0\) as the prior strength parameter.</p>
<p><strong>Intelligent Bin Merging:</strong></p>
<p>When reducing bins to meet the <code>max_bins</code> constraint, MBA employs an
IV-loss minimization strategy:</p>
<p>$$\Delta IV_{i,j} = IV_i + IV_j - IV_{merged}(i,j)$$</p>
<p>The pair with minimum \(\Delta IV\) is merged to preserve maximum
predictive information.</p>
<p><strong>Computational Complexity:</strong></p><ul><li><p>Time: \(O(k^2 \cdot m)\) where \(k\) = bins, \(m\) = iterations</p></li>
<li><p>Space: \(O(k^2)\) for IV loss cache</p></li>
<li><p>Cache hit rate typically &gt; 75% for \(k &gt; 10\)</p></li>
</ul><p><strong>Key Features:</strong></p><ul><li><p><strong>Guaranteed monotonicity</strong>: Strict enforcement with adaptive thresholds</p></li>
<li><p><strong>Bayesian regularization</strong>: Robust to sparse bins and class imbalance</p></li>
<li><p><strong>Intelligent merging</strong>: Preserves maximum information during reduction</p></li>
<li><p><strong>Adaptive thresholds</strong>: Context-aware violation detection</p></li>
<li><p><strong>Consistency verification</strong>: Final integrity checks</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Mironchyk, P., &amp; Tchistiakov, V. (2017). Monotone optimal binning algorithm
for credit risk modeling. <em>SSRN Electronic Journal</em>.
<a href="https://doi.org/10.2139/ssrn.2978774" class="external-link">doi:10.2139/ssrn.2978774</a></p>
<p>Siddiqi, N. (2017). <em>Intelligent Credit Scoring: Building and
Implementing Better Credit Risk Scorecards</em> (2nd ed.). Wiley.</p>
<p>Good, I. J. (1965). <em>The Estimation of Probabilities: An Essay on
Modern Bayesian Methods</em>. MIT Press.</p>
<p>Zeng, G. (2014). A necessary condition for a good binning algorithm in
credit scoring. <em>Applied Mathematical Sciences</em>, 8(65), 3229-3242.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="ob_categorical_jedi.html">ob_categorical_jedi</a></code> for joint entropy-driven optimization,
<code><a href="ob_categorical_dp.html">ob_categorical_dp</a></code> for dynamic programming approach,
<code><a href="ob_categorical_cm.html">ob_categorical_cm</a></code> for ChiMerge-based binning</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Example 1: Basic monotonic binning with guaranteed WoE ordering</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n_obs</span> <span class="op">&lt;-</span> <span class="fl">1500</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate risk ratings with natural monotonic relationship</span></span></span>
<span class="r-in"><span><span class="va">ratings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAA"</span>, <span class="st">"AA"</span>, <span class="st">"A"</span>, <span class="st">"BBB"</span>, <span class="st">"BB"</span>, <span class="st">"B"</span>, <span class="st">"CCC"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">default_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.35</span>, <span class="fl">0.50</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cat_feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">ratings</span>, <span class="va">n_obs</span>,</span></span>
<span class="r-in"><span>  replace <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.20</span>, <span class="fl">0.15</span>, <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bin_target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cat_feature</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">default_probs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">ratings</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Apply MBA algorithm</span></span></span>
<span class="r-in"><span><span class="va">result_mba</span> <span class="op">&lt;-</span> <span class="fu">ob_categorical_mba</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">cat_feature</span>,</span></span>
<span class="r-in"><span>  <span class="va">bin_target</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  max_bins <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Display results with guaranteed monotonic WoE</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  Bin <span class="op">=</span> <span class="va">result_mba</span><span class="op">$</span><span class="va">bin</span>,</span></span>
<span class="r-in"><span>  WoE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_mba</span><span class="op">$</span><span class="va">woe</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  IV <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_mba</span><span class="op">$</span><span class="va">iv</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Count <span class="op">=</span> <span class="va">result_mba</span><span class="op">$</span><span class="va">count</span>,</span></span>
<span class="r-in"><span>  EventRate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_mba</span><span class="op">$</span><span class="va">count_pos</span> <span class="op">/</span> <span class="va">result_mba</span><span class="op">$</span><span class="va">count</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Bin    WoE     IV Count EventRate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 A%;%AA%;%AAA -1.305 0.3529   486     0.053</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          BBB -0.700 0.1015   394     0.094</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           BB  0.211 0.0098   307     0.205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            B  1.045 0.2117   217     0.373</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          CCC  1.725 0.2845    96     0.542</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nMonotonicity check (WoE differences):\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Monotonicity check (WoE differences):</span>
<span class="r-in"><span><span class="va">woe_diffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">result_mba</span><span class="op">$</span><span class="va">woe</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Differences:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">woe_diffs</span>, <span class="fl">4</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Differences: 0.6051, 0.9113, 0.8342, 0.6795 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  All positive (increasing):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">woe_diffs</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">1e-10</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   All positive (increasing): TRUE </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Total IV:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_mba</span><span class="op">$</span><span class="va">total_iv</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total IV: 0.9604 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Converged:"</span>, <span class="va">result_mba</span><span class="op">$</span><span class="va">converged</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Converged: TRUE </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 2: Comparison with non-monotonic methods</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n_obs_comp</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sectors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tech"</span>, <span class="st">"Health"</span>, <span class="st">"Finance"</span>, <span class="st">"Manufacturing"</span>, <span class="st">"Retail"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cat_feature_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">sectors</span>, <span class="va">n_obs_comp</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bin_target_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs_comp</span>, <span class="fl">1</span>, <span class="fl">0.15</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># MBA (strictly monotonic)</span></span></span>
<span class="r-in"><span><span class="va">result_mba_comp</span> <span class="op">&lt;-</span> <span class="fu">ob_categorical_mba</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">cat_feature_comp</span>, <span class="va">bin_target_comp</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">3</span>, max_bins <span class="op">=</span> <span class="fl">4</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Standard binning (may not be monotonic)</span></span></span>
<span class="r-in"><span><span class="va">result_std_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="ob_categorical_cm.html">ob_categorical_cm</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">cat_feature_comp</span>, <span class="va">bin_target_comp</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">3</span>, max_bins <span class="op">=</span> <span class="fl">4</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nMonotonicity comparison:\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Monotonicity comparison:</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"  MBA WoE differences:"</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">result_mba_comp</span><span class="op">$</span><span class="va">woe</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   MBA WoE differences: 0.1479, 0.0667, 0.0646 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  MBA monotonic:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">result_mba_comp</span><span class="op">$</span><span class="va">woe</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">1e-10</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   MBA monotonic: TRUE </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"  Std WoE differences:"</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">result_std_comp</span><span class="op">$</span><span class="va">woe</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Std WoE differences: 0.1431, 0.0695, 0.0645 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Std monotonic:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">result_std_comp</span><span class="op">$</span><span class="va">woe</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">1e-10</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Std monotonic: TRUE </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 3: Bayesian smoothing with sparse data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n_obs_sparse</span> <span class="op">&lt;-</span> <span class="fl">400</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Small sample with rare categories</span></span></span>
<span class="r-in"><span><span class="va">categories</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cat_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.30</span>, <span class="fl">0.25</span>, <span class="fl">0.20</span>, <span class="fl">0.15</span>, <span class="fl">0.07</span>, <span class="fl">0.03</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cat_feature_sparse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">categories</span>, <span class="va">n_obs_sparse</span>,</span></span>
<span class="r-in"><span>  replace <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  prob <span class="op">=</span> <span class="va">cat_probs</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bin_target_sparse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs_sparse</span>, <span class="fl">1</span>, <span class="fl">0.08</span><span class="op">)</span> <span class="co"># 8% event rate</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">result_mba_sparse</span> <span class="op">&lt;-</span> <span class="fu">ob_categorical_mba</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">cat_feature_sparse</span>,</span></span>
<span class="r-in"><span>  <span class="va">bin_target_sparse</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  max_bins <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  bin_cutoff <span class="op">=</span> <span class="fl">0.02</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nBayesian smoothing (sparse data):\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bayesian smoothing (sparse data):</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Sample size:"</span>, <span class="va">n_obs_sparse</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sample size: 400 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Events:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">bin_target_sparse</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Events: 29 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Final bins:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result_mba_sparse</span><span class="op">$</span><span class="va">bin</span><span class="op">)</span>, <span class="st">"\n\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Final bins: 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Show how smoothing prevents extreme WoE values</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">result_mba_sparse</span><span class="op">$</span><span class="va">bin</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"  Bin %d: events=%d/%d, WoE=%.3f (smoothed)\n"</span>,</span></span>
<span class="r-in"><span>    <span class="va">i</span>,</span></span>
<span class="r-in"><span>    <span class="va">result_mba_sparse</span><span class="op">$</span><span class="va">count_pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    <span class="va">result_mba_sparse</span><span class="op">$</span><span class="va">count</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    <span class="va">result_mba_sparse</span><span class="op">$</span><span class="va">woe</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Bin 1: events=4/81, WoE=-0.421 (smoothed)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Bin 2: events=9/122, WoE=0.003 (smoothed)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Bin 3: events=13/168, WoE=0.054 (smoothed)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Bin 4: events=3/29, WoE=0.368 (smoothed)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 4: High cardinality with pre-binning</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n_obs_hc</span> <span class="op">&lt;-</span> <span class="fl">3000</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate ZIP codes (high cardinality)</span></span></span>
<span class="r-in"><span><span class="va">zips</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ZIP_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%04d"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cat_feature_hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">zips</span>, <span class="va">n_obs_hc</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bin_target_hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs_hc</span>, <span class="fl">1</span>, <span class="fl">0.12</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">result_mba_hc</span> <span class="op">&lt;-</span> <span class="fu">ob_categorical_mba</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">cat_feature_hc</span>,</span></span>
<span class="r-in"><span>  <span class="va">bin_target_hc</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  max_bins <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  max_n_prebins <span class="op">=</span> <span class="fl">20</span>,</span></span>
<span class="r-in"><span>  bin_cutoff <span class="op">=</span> <span class="fl">0.01</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nHigh cardinality performance:\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> High cardinality performance:</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Original categories:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cat_feature_hc</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Original categories: 50 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Final bins:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result_mba_hc</span><span class="op">$</span><span class="va">bin</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Final bins: 6 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"  Largest merged bin contains:"</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">result_mba_hc</span><span class="op">$</span><span class="va">bin</span>, <span class="st">"%;%"</span><span class="op">)</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span>, <span class="st">"categories\n"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Largest merged bin contains: 19 categories</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Verify monotonicity in high-cardinality case</span></span></span>
<span class="r-in"><span><span class="va">woe_monotonic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">result_mba_hc</span><span class="op">$</span><span class="va">woe</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">1e-10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  WoE monotonic:"</span>, <span class="va">woe_monotonic</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   WoE monotonic: TRUE </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 5: Convergence behavior</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n_obs_conv</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">business_sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Micro"</span>, <span class="st">"Small"</span>, <span class="st">"Medium"</span>, <span class="st">"Large"</span>, <span class="st">"Enterprise"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cat_feature_conv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">business_sizes</span>, <span class="va">n_obs_conv</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bin_target_conv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs_conv</span>, <span class="fl">1</span>, <span class="fl">0.18</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Test different convergence thresholds</span></span></span>
<span class="r-in"><span><span class="va">thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-3</span>, <span class="fl">1e-6</span>, <span class="fl">1e-9</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">thresh</span> <span class="kw">in</span> <span class="va">thresholds</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">result_conv</span> <span class="op">&lt;-</span> <span class="fu">ob_categorical_mba</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">cat_feature_conv</span>,</span></span>
<span class="r-in"><span>    <span class="va">bin_target_conv</span>,</span></span>
<span class="r-in"><span>    min_bins <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>    max_bins <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>    convergence_threshold <span class="op">=</span> <span class="va">thresh</span>,</span></span>
<span class="r-in"><span>    max_iterations <span class="op">=</span> <span class="fl">50</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nThreshold %.0e:\n"</span>, <span class="va">thresh</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Final bins:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result_conv</span><span class="op">$</span><span class="va">bin</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Total IV:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_conv</span><span class="op">$</span><span class="va">total_iv</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Converged:"</span>, <span class="va">result_conv</span><span class="op">$</span><span class="va">converged</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Iterations:"</span>, <span class="va">result_conv</span><span class="op">$</span><span class="va">iterations</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Check monotonicity preservation</span></span></span>
<span class="r-in"><span>  <span class="va">monotonic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">result_conv</span><span class="op">$</span><span class="va">woe</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">1e-10</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Monotonic:"</span>, <span class="va">monotonic</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Threshold 1e-03:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Final bins: 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total IV: 0.0404 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Converged: TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Iterations: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Monotonic: TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Threshold 1e-06:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Final bins: 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total IV: 0.0404 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Converged: FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Iterations: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Monotonic: TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Threshold 1e-09:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Final bins: 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total IV: 0.0404 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Converged: FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Iterations: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Monotonic: TRUE </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 6: Missing value handling</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">555</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cat_feature_na</span> <span class="op">&lt;-</span> <span class="va">cat_feature</span></span></span>
<span class="r-in"><span><span class="va">na_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">75</span><span class="op">)</span> <span class="co"># 5% missing</span></span></span>
<span class="r-in"><span><span class="va">cat_feature_na</span><span class="op">[</span><span class="va">na_indices</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">result_mba_na</span> <span class="op">&lt;-</span> <span class="fu">ob_categorical_mba</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">cat_feature_na</span>,</span></span>
<span class="r-in"><span>  <span class="va">bin_target</span>,</span></span>
<span class="r-in"><span>  min_bins <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  max_bins <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Locate NA bin</span></span></span>
<span class="r-in"><span><span class="va">na_bin_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"NA"</span>, <span class="va">result_mba_na</span><span class="op">$</span><span class="va">bin</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">na_bin_idx</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nMissing value treatment:\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  NA bin:"</span>, <span class="va">result_mba_na</span><span class="op">$</span><span class="va">bin</span><span class="op">[</span><span class="va">na_bin_idx</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  NA count:"</span>, <span class="va">result_mba_na</span><span class="op">$</span><span class="va">count</span><span class="op">[</span><span class="va">na_bin_idx</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"  NA event rate:"</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_mba_na</span><span class="op">$</span><span class="va">count_pos</span><span class="op">[</span><span class="va">na_bin_idx</span><span class="op">]</span> <span class="op">/</span></span></span>
<span class="r-in"><span>      <span class="va">result_mba_na</span><span class="op">$</span><span class="va">count</span><span class="op">[</span><span class="va">na_bin_idx</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  NA WoE:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_mba_na</span><span class="op">$</span><span class="va">woe</span><span class="op">[</span><span class="va">na_bin_idx</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"  Monotonicity preserved:"</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">result_mba_na</span><span class="op">$</span><span class="va">woe</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">1e-10</span><span class="op">)</span>, <span class="st">"\n"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Missing value treatment:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   NA bin: NA%;%BB </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   NA count: 367 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   NA event rate: 0.202 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   NA WoE: 0.189 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Monotonicity preserved: TRUE </span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by José Evandeilton Lopes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

